[{"path":"https://sebkrantz.github.io/flownet/articles/introduction.html","id":"introduction","dir":"Articles","previous_headings":"","what":"Introduction","title":"Introduction to flownet","text":"flownet package provides efficient tools transportation modeling, specifically network processing/preparation, route enumeration, traffic assignment tasks. package implements path-sized logit (PSL) model traffic assignment, accounts route overlap assigning traffic flows network edges. can handle directed undirected graphs, ’s network processing functions/algorithms support multimodal networks. key design decision represent network graphs using simple data frames node columns. facilitates applied work, e.g., manual network edits adding multimodal connector links, development generalized cost functions using network features.","code":""},{"path":"https://sebkrantz.github.io/flownet/articles/introduction.html","id":"getting-started","dir":"Articles","previous_headings":"","what":"Getting Started","title":"Introduction to flownet","text":"Let’s start loading required packages exploring example datasets included flownet: package includes four example datasets Africa: africa_network: road transport network 2,825 LINESTRING features representing existing roads (2,344 edges) proposed new links (481 edges). edge includes attributes distance, travel duration, border crossing costs, terrain ruggedness, road upgrade costs. africa_cities_ports: 453 African cities population > 100,000 international ports. Includes population data, capital status, port cargo outflows. africa_segments: 14,358 raw network segments representing intersected road routes. Useful demonstrating network consolidation simplification functions. africa_trade: Bilateral trade flows 47 African countries aggregated HS section (21 product categories). Values represent annual averages 2012-2022. africa_network, africa_cities_ports, africa_segments datasets Krantz, S. (2024). Optimal Investments Africa’s Road Network. Policy Research Working Paper 10893. World Bank. Replication materials available github.com/SebKrantz/OptimalAfricanRoads. Let’s examine data:","code":"library(fastverse) fastverse_extend(flownet, sf, tmap) tmap_mode(\"plot\") # View network structure (existing links only) africa_net <- fsubset(africa_network, !add, -add) str(africa_net, max.level = 1) #> Classes 'sf' and 'data.frame':   2344 obs. of  28 variables: #>  $ from             : int  1 2 2 2 3 3 4 4 5 5 ... #>  $ to               : int  2 3 4 5 4 10 5 17 13 17 ... #>  $ from_ctry        : chr  \"SEN\" \"SEN\" \"SEN\" \"SEN\" ... #>  $ to_ctry          : chr  \"SEN\" \"SEN\" \"SEN\" \"SEN\" ... #>  $ FX               : num  -17.4 -17 -17 -17 -16.6 ... #>  $ FY               : num  14.7 14.7 14.7 14.7 15.1 ... #>  $ TX               : num  -17 -16.6 -16.5 -16.4 -16.5 ... #>  $ TY               : num  14.7 15.1 14.8 14.3 14.8 ... #>  $ sp_distance      : num  43272 63043 62787 78226 43802 ... #>  $ distance         : num  65988 87290 89470 99998 61112 ... #>  $ duration         : num  46.1 72.2 61.1 72.9 72.9 ... #>  $ speed_kmh        : num  85.8 72.5 87.9 82.3 50.3 ... #>  $ passes           : num  104.3 10 1.5 55 1 ... #>  $ gravity          : num  215.33 20.138 11.642 122.201 0.526 ... #>  $ gravity_rd       : num  157.523 14.738 10.558 88.008 0.395 ... #>  $ border_dist      : num  0 0 0 0 0 0 0 0 0 0 ... #>  $ total_dist       : num  65988 87290 89470 99998 61112 ... #>  $ border_time      : num  0 0 0 0 0 0 0 0 0 0 ... #>  $ total_time       : num  46.1 72.2 61.1 72.9 72.9 ... #>  $ duration_100kmh  : num  39.6 52.4 53.7 60 36.7 ... #>  $ total_time_100kmh: num  39.6 52.4 53.7 60 36.7 ... #>  $ rugg             : num  25204 23657 25761 24773 11332 ... #>  $ pop_wpop         : num  670689 191412 177028 137875 65316 ... #>  $ pop_wpop_km2     : num  2263 450 415 262 216 ... #>  $ cost_km          : num  699437 605210 607230 581290 520635 ... #>  $ upgrade_cat      : chr  \"Asphalt Mix Resurfacing\" \"Mixed Works\" \"Asphalt Mix Resurfacing\" \"Asphalt Mix Resurfacing\" ... #>  $ ug_cost_km       : num  165533 325805 143711 137572 440804 ... #>  $ geometry         :sfc_LINESTRING of length 2344; first list element:  'XY' num [1:10, 1:2] -17.4 -17 -17 -17.1 -17.1 ... #>  - attr(*, \"sf_column\")= chr \"geometry\" #>  - attr(*, \"agr\")= Factor w/ 3 levels \"constant\",\"aggregate\",..: NA NA NA NA NA NA NA NA NA NA ... #>   ..- attr(*, \"names\")= chr [1:24] \"from\" \"to\" NA NA ...  # View cities/ports head(fselect(africa_cities_ports, city, country, population)) #> Simple feature collection with 6 features and 3 fields #> Geometry type: POINT #> Dimension:     XY #> Bounding box:  xmin: 3.3841 ymin: -26.2044 xmax: 39.2803 ymax: 30.0444 #> Geodetic CRS:  WGS 84 #>            city          country population                 geometry #> 1         Cairo            Egypt   28621082  POINT (31.2358 30.0444) #> 2         Lagos          Nigeria   19932062     POINT (3.3841 6.455) #> 3      Kinshasa Congo (Kinshasa)   16579488  POINT (15.3119 -4.3219) #> 4        Luanda           Angola   12376210  POINT (13.2344 -8.8383) #> 5  Johannesburg     South Africa   12282763 POINT (28.0456 -26.2044) #> 6 Dar es Salaam         Tanzania    9048912  POINT (39.2803 -6.8161)  # View trade data structure head(africa_trade) #>    iso3_o iso3_d section_code #>    <fctr> <fctr>        <int> #> 1:    AGO    BDI           16 #> 2:    AGO    BEN            1 #> 3:    AGO    BEN            4 #> 4:    AGO    BEN            5 #> 5:    AGO    BEN            6 #> 6:    AGO    BEN            7 #>                                                                                                                                                                                                   section_name #>                                                                                                                                                                                                         <fctr> #> 1: Machinery and mechanical appliances, electrical equipment, parts thereof, sound recorders and reproducers, television image and souch recorders and reproducers, and parts and accessories of such articles #> 2:                                                                                                                                                                            Live animals and animal products #> 3:                                                                                                           Prepared foodstuffs, beverages, spirits and vinegar, tobacco and manufactured tobacco substitutes #> 4:                                                                                                                                                                                            Mineral products #> 5:                                                                                                                                                               Product of the chemicals or allied industries #> 6:                                                                                                                                                  Plastics and articles thereof, rubber and articles thereof #>         hs2_codes     value     value_kd  quantity #>            <fctr>     <num>        <num>     <num> #> 1:             84    5.1040    5.1040000    0.9870 #> 2:              3 6810.4528 6527.0068247 8777.0133 #> 3:     19, 20, 22    9.5135    9.0984152   20.7370 #> 4:             27 3583.7897 3536.4303649 8369.7665 #> 5: 30, 32, 33, 34    0.9435    0.9319342    0.0275 #> 6:         39, 40   71.2590   71.9540899   31.2510"},{"path":"https://sebkrantz.github.io/flownet/articles/introduction.html","id":"basic-workflow-example","dir":"Articles","previous_headings":"","what":"Basic Workflow Example","title":"Introduction to flownet","text":"section demonstrates complete workflow network preparation traffic assignment visualization. ’ll use gravity-based OD matrix derived city populations.","code":""},{"path":"https://sebkrantz.github.io/flownet/articles/introduction.html","id":"step-1-visualize-the-network","dir":"Articles","previous_headings":"Basic Workflow Example","what":"Step 1: Visualize the Network","title":"Introduction to flownet","text":"First, let’s visualize network understand structure:","code":"# Plot network colored by travel speed tm_basemap(\"CartoDB.Positron\", zoom = 4) + tm_shape(africa_net) +   tm_lines(col = \"speed_kmh\",            col.scale = tm_scale_continuous(values = \"turbo\", values.range = c(0.1, 0.9)),            col.legend = tm_legend(\"Speed (km/h)\", position = c(\"left\", \"bottom\"),                                   frame = FALSE, text.size = 0.8, title.size = 1,                                    item.height = 2.5), lwd = 1.5) + tm_layout(frame = FALSE)"},{"path":"https://sebkrantz.github.io/flownet/articles/introduction.html","id":"step-2-convert-network-to-graph","dir":"Articles","previous_headings":"Basic Workflow Example","what":"Step 2: Convert Network to Graph","title":"Introduction to flownet","text":"linestrings_to_graph() function converts LINESTRING geometries graph data frame format required traffic assignment. case, relevant columns already provided, thus need strip geometry column turn normal data frame. resulting graph data frame contains: edge: Edge identifier (optional) , : Node IDs FX, FY, TX, TY: Node coordinates (optional) original columns network (distance, duration, total_time, etc.)","code":"# Convert to graph (use atomic_elem to drop sf geometry, qDF for data.frame) graph <- atomic_elem(africa_net) |> qDF() head(graph) #>   from to from_ctry to_ctry        FX       FY        TX       TY sp_distance #> 1    1  2       SEN     SEN -17.44671 14.69281 -17.04453 14.70297    43272.22 #> 2    2  3       SEN     SEN -17.04453 14.70297 -16.63849 15.11222    63043.01 #> 3    2  4       SEN     SEN -17.04453 14.70297 -16.46332 14.75651    62786.56 #> 4    2  5       SEN     SEN -17.04453 14.70297 -16.42054 14.34236    78226.09 #> 5    3  4       SEN     SEN -16.63849 15.11222 -16.46332 14.75651    43802.37 #> 6    3 10       SEN     SEN -16.63849 15.11222 -16.24391 15.63569    71956.96 #>   distance duration speed_kmh   passes     gravity  gravity_rd border_dist #> 1  65988.0    46.15  85.79155 104.3333 215.3302926 157.5228265           0 #> 2  87290.5    72.25  72.49038  10.0000  20.1382178  14.7376257           0 #> 3  89469.5    61.10  87.85876   1.5000  11.6420372  10.5577017           0 #> 4  99998.0    72.90  82.30288  55.0000 122.2011739  88.0080152           0 #> 5  61111.5    72.90  50.29753   1.0000   0.5259515   0.3953356           0 #> 6  73391.0    61.20  71.95196  31.0000  23.0342955  16.8520354           0 #>   total_dist border_time total_time duration_100kmh total_time_100kmh      rugg #> 1    65988.0           0      46.15         39.5928           39.5928 25203.645 #> 2    87290.5           0      72.25         52.3743           52.3743 23656.895 #> 3    89469.5           0      61.10         53.6817           53.6817 25761.240 #> 4    99998.0           0      72.90         59.9988           59.9988 24773.338 #> 5    61111.5           0      72.90         36.6669           36.6669 11331.973 #> 6    73391.0           0      61.20         44.0346           44.0346  1745.889 #>    pop_wpop pop_wpop_km2  cost_km             upgrade_cat ug_cost_km #> 1 670689.38    2262.9802 699437.0 Asphalt Mix Resurfacing   165533.4 #> 2 191412.11     450.2150 605210.4             Mixed Works   325804.9 #> 3 177027.86     415.0577 607229.6 Asphalt Mix Resurfacing   143711.0 #> 4 137874.58     262.0664 581289.6 Asphalt Mix Resurfacing   137571.9 #> 5  65316.04     216.0512 520634.9                 Upgrade   440804.2 #> 6 102835.91     212.9464 415457.6             Mixed Works   223654.7"},{"path":"https://sebkrantz.github.io/flownet/articles/introduction.html","id":"step-3-extract-nodes-and-map-cities","dir":"Articles","previous_headings":"Basic Workflow Example","what":"Step 3: Extract Nodes and Map Cities","title":"Introduction to flownet","text":"Next, need map city/port locations nearest network nodes:","code":"# Extract nodes with spatial coordinates nodes <- nodes_from_graph(graph, sf = TRUE)  # Map cities/ports to nearest nodes nearest_nodes <- nodes$node[st_nearest_feature(africa_cities_ports, nodes)]"},{"path":"https://sebkrantz.github.io/flownet/articles/introduction.html","id":"step-4-create-od-matrix","dir":"Articles","previous_headings":"Basic Workflow Example","what":"Step 4: Create OD Matrix","title":"Introduction to flownet","text":"example, ’ll create simple gravity-based OD matrix city populations. melt_od_matrix() function converts matrix long format required run_assignment(): resulting data frame contains columns , , flow, positive, finite flow values.","code":"# Create gravity-based OD matrix (population product scaled down) od_mat <- outer(africa_cities_ports$population, africa_cities_ports$population) / 1e12 dimnames(od_mat) <- list(nearest_nodes, nearest_nodes)  # Convert to long format od_matrix_long <- melt_od_matrix(od_mat) head(od_matrix_long) #>   from to       flow #> 1    1  1 10.3925963 #> 2    1  6  0.3804031 #> 3    1  8  4.6445025 #> 4    1  8  0.5133217 #> 5    1  9  0.3426110 #> 6    1 11  3.1488124"},{"path":"https://sebkrantz.github.io/flownet/articles/introduction.html","id":"step-5-run-traffic-assignment","dir":"Articles","previous_headings":"Basic Workflow Example","what":"Step 5: Run Traffic Assignment","title":"Introduction to flownet","text":"Now can run traffic assignment. run_assignment() function: Enumerates alternative routes OD pair Computes path probabilities accounting route overlap (PSL model) Assigns flows network edges large networks like one, ’ll use --Nothing (AoN) method faster: Key parameters: cost.column: cost column use route computation (“duration” minutes) method: “PSL” (path-sized logit) “AoN” (--nothing) return.extra: Additional results return (“” returns everything)","code":"# Run Traffic Assignment (All-or-Nothing method for speed) result <- run_assignment(graph, od_matrix_long, cost.column = \"duration\",                          method = \"AoN\", return.extra = \"all\") #> Created graph with 1379 nodes and 2344 edges... #> 495 OD-pairs have zero or non-finite flow values and will be skipped... print(result) #> FlowNet object #> Call: run_assignment(graph_df = graph, od_matrix_long = od_matrix_long,      cost.column = \"duration\", method = \"AoN\", return.extra = \"all\")  #>  #> Number of nodes: 1379  #> Number of edges: 2344  #> Number of simulations/OD-pairs: 204714  #>  #> Average path length in edges (SD): 34.99213  (19.56615) #> Average number of visits per edge (SD): 3056.049  (5875.129) #> Average path cost (SD): 4345.631  (2253.376) #>  #> Final flows summary statistics: #>      N  Ndist     Mean       SD  Min       Max  Skew   Kurt #>   2344   2017  2187.89  4553.86    0  37250.26  3.49  18.49 #>   1%  5%   10%    25%     50%      75%   90%       95%       99% #>    0   0  1.08  36.57  295.39  1662.86  7581  11386.38  20188.24"},{"path":"https://sebkrantz.github.io/flownet/articles/introduction.html","id":"step-6-visualize-results","dir":"Articles","previous_headings":"Basic Workflow Example","what":"Step 6: Visualize Results","title":"Introduction to flownet","text":"Finally, can visualize assigned flows network:","code":"# Add flows to network for visualization africa_net$final_flows_log10 <- log10(result$final_flows + 1)  tm_basemap(\"CartoDB.Positron\", zoom = 4) + tm_shape(africa_net) +   tm_lines(col = \"final_flows_log10\",            col.scale = tm_scale_continuous(values = \"brewer.yl_or_rd\"),            col.legend = tm_legend(\"Log10 Flows\", position = c(\"left\", \"bottom\"),                                   frame = FALSE, text.size = 0.8, title.size = 1), lwd = 1.5) + tm_shape(africa_cities_ports) + tm_dots(size = 0.15, fill = \"grey30\") + tm_layout(frame = FALSE)"},{"path":"https://sebkrantz.github.io/flownet/articles/introduction.html","id":"advanced-workflow-trade-flow-disaggregation","dir":"Articles","previous_headings":"","what":"Advanced Workflow: Trade Flow Disaggregation","title":"Introduction to flownet","text":"realistic modeling, can disaggregate country-level trade flows city-level using population shares. approach distributes trade countries across respective cities proportionally population.","code":""},{"path":"https://sebkrantz.github.io/flownet/articles/introduction.html","id":"step-1-compute-city-population-shares","dir":"Articles","previous_headings":"Advanced Workflow: Trade Flow Disaggregation","what":"Step 1: Compute City Population Shares","title":"Introduction to flownet","text":"","code":"# Compute each city's share of its country's population city_pop <- africa_cities_ports |> atomic_elem() |> qDF() |>   fcompute(node = nearest_nodes,            city = qF(city_country),            pop_share = fsum(population, iso3, TRA = \"/\"),            keep = \"iso3\")  head(city_pop) #>   iso3 node                        city pop_share #> 1  EGY  937               Cairo - Egypt 0.6554678 #> 2  NGA  289             Lagos - Nigeria 0.3860030 #> 3  COD  635 Kinshasa - Congo (Kinshasa) 0.4784988 #> 4  AGO  577             Luanda - Angola 0.5361630 #> 5  ZAF  913 Johannesburg - South Africa 0.4947698 #> 6  TZA 1296    Dar es Salaam - Tanzania 0.6238426"},{"path":"https://sebkrantz.github.io/flownet/articles/introduction.html","id":"step-2-disaggregate-trade-flows","dir":"Articles","previous_headings":"Advanced Workflow: Trade Flow Disaggregation","what":"Step 2: Disaggregate Trade Flows","title":"Introduction to flownet","text":"","code":"# Aggregate trade to country-country level (sum across HS sections) trade_agg <- africa_trade |> collap(quantity ~ iso3_o + iso3_d, fsum)  # Join with city population shares for origin and destination # add_stub adds suffix to all columns, so iso3 -> iso3_o matches trade_agg$iso3_o od_matrix_trade <- trade_agg |>   join(city_pop |> add_stub(\"_o\", FALSE), multiple = TRUE) |>   join(city_pop |> add_stub(\"_d\", FALSE), multiple = TRUE) |>   fmutate(flow = quantity * pop_share_o * pop_share_d) |>   frename(from = node_o, to = node_d) |>   fsubset(flow > 0 & from != to) #> left join: trade_agg[iso3_o] 1971/1971 (100%) <41.94:9.62> y[iso3_o] 452/453 (99.8%) #> left join: x[iso3_d] 19685/19685 (100%) <418.83:9.62> y[iso3_d] 452/453 (99.8%)  head(od_matrix_trade) #>    iso3_o iso3_d quantity  from            city_o pop_share_o    to #>    <fctr> <fctr>    <num> <int>            <fctr>       <num> <int> #> 1:    AGO    BDI    0.987   577   Luanda - Angola  0.53616303   962 #> 2:    AGO    BDI    0.987   550  Lubango - Angola  0.03794550   962 #> 3:    AGO    BDI    0.987   540  Cabinda - Angola  0.03202289   962 #> 4:    AGO    BDI    0.987   613   Huambo - Angola  0.02883361   962 #> 5:    AGO    BDI    0.987   645  Malanje - Angola  0.02843812   962 #> 6:    AGO    BDI    0.987   549 Benguela - Angola  0.05153641   962 #>                 city_d pop_share_d       flow #>                 <fctr>       <num>      <num> #> 1: Bujumbura - Burundi           1 0.52919291 #> 2: Bujumbura - Burundi           1 0.03745221 #> 3: Bujumbura - Burundi           1 0.03160660 #> 4: Bujumbura - Burundi           1 0.02845877 #> 5: Bujumbura - Burundi           1 0.02806843 #> 6: Bujumbura - Burundi           1 0.05086644"},{"path":"https://sebkrantz.github.io/flownet/articles/introduction.html","id":"step-3-run-assignment-with-trade-flows","dir":"Articles","previous_headings":"Advanced Workflow: Trade Flow Disaggregation","what":"Step 3: Run Assignment with Trade Flows","title":"Introduction to flownet","text":"","code":"# Run Traffic Assignment with trade-based OD matrix result_trade <- run_assignment(graph, od_matrix_trade, cost.column = \"duration\",                                method = \"AoN\", return.extra = \"all\") #> Created graph with 1379 nodes and 2344 edges... print(result_trade) #> FlowNet object #> Call: run_assignment(graph_df = graph, od_matrix_long = od_matrix_trade,      cost.column = \"duration\", method = \"AoN\", return.extra = \"all\")  #>  #> Number of nodes: 1379  #> Number of edges: 2344  #> Number of simulations/OD-pairs: 189020  #>  #> Average path length in edges (SD): 36.15387  (19.23456) #> Average number of visits per edge (SD): 2915.445  (5685.838) #> Average path cost (SD): 4477.602  (2187.799) #>  #> Final flows summary statistics: #>      N  Ndist         Mean           SD  Min          Max  Skew   Kurt #>   2344   1864  1'273306.07  2'915489.75    0  21'964576.8   3.7  18.51 #>   1%  5%  10%       25%        50%        75%          90%          95% #>    0   0    0  17330.95  142839.71  911817.37  3'624008.55  6'948734.38 #>           99% #>   14'969459.2 # Add flows to network for visualization africa_net$final_flows_log10 <- log10(result_trade$final_flows + 1)  tm_basemap(\"CartoDB.Positron\", zoom = 4) + tm_shape(africa_net) +   tm_lines(col = \"final_flows_log10\",            col.scale = tm_scale_continuous(values = \"brewer.yl_or_rd\"),            col.legend = tm_legend(\"Log10 Trade Flows\", position = c(\"left\", \"bottom\"),                                   frame = FALSE, text.size = 0.8, title.size = 1), lwd = 1.5) + tm_shape(africa_cities_ports) + tm_dots(size = 0.15, fill = \"grey30\") + tm_layout(frame = FALSE)"},{"path":"https://sebkrantz.github.io/flownet/articles/introduction.html","id":"advanced-workflow-with-network-consolidation","dir":"Articles","previous_headings":"","what":"Advanced Workflow with Network Consolidation","title":"Introduction to flownet","text":"large complex networks, ’s often beneficial consolidate graph removing intermediate nodes merging edges. simplifies network topology preserving connectivity, can significantly improve computational performance.","code":""},{"path":"https://sebkrantz.github.io/flownet/articles/introduction.html","id":"using-raw-segments","dir":"Articles","previous_headings":"Advanced Workflow with Network Consolidation","what":"Using Raw Segments","title":"Introduction to flownet","text":"africa_segments dataset provides raw network segments can processed full consolidation workflow. obtained computing fastest car routes 453 African (port-)cities less 2000km apart using osrm, feeding stplanr::overline() rmapshaper::ms_simplify(), just taking start end coordinate segment. final network africa_network used created using segments similar way demonstrate (consolidation followed clustering simplification final call osrm get simplified edge geometries better visual appearance).","code":"# Convert segments to sf and then to graph graph_seg <- africa_segments |>   linestrings_from_graph() |>   linestrings_to_graph() |>   create_undirected_graph()  # Get nodes and map cities nodes_seg <- nodes_from_graph(graph_seg, sf = TRUE) nearest_nodes_seg <- nodes_seg$node[st_nearest_feature(africa_cities_ports, nodes_seg)]  cat(\"Original segments:\", nrow(graph_seg), \"\\n\") #> Original segments: 11385"},{"path":"https://sebkrantz.github.io/flownet/articles/introduction.html","id":"consolidate-graph","dir":"Articles","previous_headings":"Advanced Workflow with Network Consolidation","what":"Consolidate Graph","title":"Introduction to flownet","text":"consolidate_graph() function recursively removes intermediate nodes (nodes occur exactly twice) merges connecting edges. step, network attributes aggregated using collap(), , default, uses mean numeric statistical mode categorical attributes (columns), supports weights. use keep indicates node IDs preserve (city/port closest nodes).","code":"# Consolidate graph, preserving city nodes graph_cons <- consolidate_graph(graph_seg, keep = nearest_nodes_seg, w = ~ .length) #> Consolidating undirected graph graph_seg with 11385 edges using full recursion #> Initial node degrees: #>    1    2    3    4    5    6    7    8    9   10  #>  125 5293 3240  395  102   31    4    2    1    1  #>  #> Dropped 44 loop edges #> Dropped 11 edges leading to singleton nodes #> Oriented 3431 undirected intermediate edges #> Consolidated 5079 intermediate nodes #> Oriented 10 undirected intermediate edges #> Consolidated 10 intermediate nodes #> Aggregated 11330 edges down to 6597 edges #> Oriented 361 undirected intermediate edges #> Consolidated 375 intermediate nodes #> Oriented 8 undirected intermediate edges #> Consolidated 8 intermediate nodes #> Aggregated 6597 edges down to 6264 edges #> Oriented 41 undirected intermediate edges #> Consolidated 43 intermediate nodes #> Oriented 1 undirected intermediate edges #> Consolidated 1 intermediate nodes #> Aggregated 6264 edges down to 6224 edges #> Oriented 2 undirected intermediate edges #> Consolidated 3 intermediate nodes #> Aggregated 6224 edges down to 6221 edges #> No nodes to consolidate, returning graph #>  #> Consolidated undirected graph graph_seg from 11385 edges to 6221 edges (54.6%) #> Final node degrees: #>    1    2    3    4    5    6    7    8  #>  114  236 3246  392   84   18    2    1  cat(\"After consolidation:\", nrow(graph_cons), \"\\n\") #> After consolidation: 6221"},{"path":"https://sebkrantz.github.io/flownet/articles/introduction.html","id":"compare-original-vs-consolidated-network","dir":"Articles","previous_headings":"Advanced Workflow with Network Consolidation","what":"Compare Original vs Consolidated Network","title":"Introduction to flownet","text":"number passes segment along different routes generated stplanr::overline(). routes traversed , indicate traffic flow.","code":"tm_basemap(\"CartoDB.Positron\", zoom = 4) + tm_shape(linestrings_from_graph(graph_seg)) +   tm_lines(col = \"passes\",            col.scale = tm_scale_continuous(values = \"turbo\", values.range = c(0.1, 0.9)),            col.legend = tm_legend(\"N. Passes\",                                   position = c(\"left\", \"bottom\"), frame = FALSE,                                   text.size = 0.8, title.size = 1), lwd = 1.5) + tm_layout(frame = FALSE) + tm_title(paste(\"Original:\", nrow(graph_seg), \"edges\")) tm_basemap(\"CartoDB.Positron\", zoom = 4) + tm_shape(linestrings_from_graph(graph_cons)) +   tm_lines(col = \"passes\",            col.scale = tm_scale_continuous(values = \"turbo\", values.range = c(0.1, 0.9)),            col.legend = tm_legend(\"N. Passes\",                                   position = c(\"left\", \"bottom\"), frame = FALSE,                                   text.size = 0.8, title.size = 1), lwd = 1.5) + tm_layout(frame = FALSE) + tm_title(paste(\"Consolidated:\", nrow(graph_cons), \"edges\"))"},{"path":"https://sebkrantz.github.io/flownet/articles/introduction.html","id":"network-simplification-with-simplify_network","dir":"Articles","previous_headings":"","what":"Network Simplification with simplify_network()","title":"Introduction to flownet","text":"consolidate_graph() simplifies network topology preserving full connectivity, simplify_network() function provides two methods reducing network complexity preserving connectivity important nodes: shortest-paths: Keeps edges traversed shortest paths specified nodes cluster: Spatially clusters nodes using leaderCluster algorithm contracts graph two functions complimentary, calling simplify_network(), consolidate_graph() called simplify topology reduced network.","code":""},{"path":"https://sebkrantz.github.io/flownet/articles/introduction.html","id":"shortest-paths-method","dir":"Articles","previous_headings":"Network Simplification with simplify_network()","what":"Shortest-Paths Method","title":"Introduction to flownet","text":"method computes shortest paths specified nodes retains traversed edges:","code":"# Simplify network using shortest paths graph_simple <- simplify_network(graph_cons, nearest_nodes_seg,                                  method = \"shortest-paths\",                                  cost.column = \".length\")  cat(\"Consolidated edges:\", nrow(graph_cons), \"\\n\") #> Consolidated edges: 6221 cat(\"Simplified edges:\", nrow(graph_simple), \"\\n\") #> Simplified edges: 5445  # Visualize tm_basemap(\"CartoDB.Positron\", zoom = 4) + tm_shape(linestrings_from_graph(graph_simple)) +   tm_lines(col = \"passes\",            col.scale = tm_scale_continuous(values = \"turbo\", values.range = c(0.1, 0.9)),            col.legend = tm_legend(\"N. Passes\",                                   position = c(\"left\", \"bottom\"), frame = FALSE,                                   text.size = 0.8, title.size = 1), lwd = 1.5) + tm_layout(frame = FALSE) + tm_title(paste(\"Simplified (SP):\", nrow(graph_simple), \"edges\"))"},{"path":"https://sebkrantz.github.io/flownet/articles/introduction.html","id":"cluster-method","dir":"Articles","previous_headings":"Network Simplification with simplify_network()","what":"Cluster Method","title":"Introduction to flownet","text":"cluster method uses leaderCluster algorithm spatially group nearby nodes contract graph. useful creating coarser network representations:  Key cluster parameters: radius_km$nodes: Radius (km) around preserved nodes assign nearby nodes radius_km$cluster: Clustering radius (km) remaining nodes Let’s see can assign network:","code":"# Compute node weights for clustering (sum of gravity at each node) node_weights <- rowbind(   fselect(graph_cons, node = from, gravity_rd),   fselect(graph_cons, to, gravity_rd),use.names = FALSE) |>   collap(~ node, fsum)  # Cluster-based simplification graph_cluster <- simplify_network(graph_cons, nearest_nodes_seg,                                   method = \"cluster\",                                   cost.column = node_weights$gravity_rd,                                   radius_km = list(nodes = 30, cluster = 27),                                   w = ~ .length)   cat(\"Clustered edges:\", nrow(graph_cluster), \"\\n\") #> Clustered edges: 2426  tm_basemap(\"CartoDB.Positron\", zoom = 4) + tm_shape(linestrings_from_graph(graph_cluster)) +   tm_lines(col = \"passes\",            col.scale = tm_scale_continuous(values = \"turbo\", values.range = c(0.1, 0.9)),            col.legend = tm_legend(\"N. Passes\",                                   position = c(\"left\", \"bottom\"), frame = FALSE,                                   text.size = 0.8, title.size = 1), lwd = 1.5) + tm_layout(frame = FALSE) + tm_title(paste(\"Simplified (CL):\", nrow(graph_cluster), \"edges\")) dimnames(od_mat) <- list(nearest_nodes_seg, nearest_nodes_seg) od_matrix_long <- melt_od_matrix(od_mat)  # Run Traffic Assignment with gravity-based OD matrix result_cl <- run_assignment(graph_cluster, od_matrix_long, cost.column = \".length\",                             method = \"AoN\", return.extra = \"all\") #> Created graph with 1444 nodes and 2426 edges... #> 455 OD-pairs have zero or non-finite flow values and will be skipped... print(result_cl) #> FlowNet object #> Call: run_assignment(graph_df = graph_cluster, od_matrix_long = od_matrix_long,      cost.column = \".length\", method = \"AoN\", return.extra = \"all\")  #>  #> Number of nodes: 1444  #> Number of edges: 2426  #> Number of simulations/OD-pairs: 204754  #>  #> Average path length in edges (SD): 34.92143  (19.1385) #> Average number of visits per edge (SD): 2947.363  (5805.167) #> Average path cost (SD): 3878850  (2094879) #>  #> Final flows summary statistics: #>      N  Ndist     Mean       SD  Min       Max  Skew   Kurt #>   2426   2008  2120.94  4190.57    0  41186.09  4.13  25.61 #>   1%  5%   10%    25%     50%      75%      90%     95%       99% #>    0   0  0.63  64.58  473.27  2252.21  5842.42  9225.6  24624.15  # Add flows to network for visualization graph_cluster$final_flows_log10 <- log10(result_cl$final_flows + 1)  tm_basemap(\"CartoDB.Positron\", zoom = 4) + tm_shape(linestrings_from_graph(graph_cluster)) +   tm_lines(col = \"final_flows_log10\",            col.scale = tm_scale_continuous(values = \"brewer.yl_or_rd\"),            col.legend = tm_legend(\"Log10 Flows\", position = c(\"left\", \"bottom\"),                                   frame = FALSE, text.size = 0.8, title.size = 1), lwd = 1.5) + tm_shape(africa_cities_ports) + tm_dots(size = 0.15, fill = \"grey30\") + tm_layout(frame = FALSE)"},{"path":"https://sebkrantz.github.io/flownet/articles/introduction.html","id":"key-concepts-and-functions","dir":"Articles","previous_headings":"","what":"Key Concepts and Functions","title":"Introduction to flownet","text":"overview showcased essential package functions. Path-Sized Logit (PSL) assignment model used takes minutes process around 200k OD-pairs PSL, beholding selection routes must generated OD pair. PSL flow assignments smoother/distributed, realistic --nothing method assigns entire flow shortest path without regard alternative routes. remainder vignette provides theoretical overview PSL model, followed summary key functions package.","code":""},{"path":"https://sebkrantz.github.io/flownet/articles/introduction.html","id":"path-sized-logit-model","dir":"Articles","previous_headings":"Key Concepts and Functions","what":"Path-Sized Logit Model","title":"Introduction to flownet","text":"Path-Sized Logit (PSL) model discrete choice model used traffic assignment overcomes independence irrelevant alternatives (IIA) property standard Multinomial Logit (MNL) model. transport networks, alternative routes often overlap significantly, sharing common edges. MNL model treats overlapping routes independent, leading overestimation flow shared segments. PSL model introduces correction term (path-size factor) utility function route, penalizing paths share links alternatives.","code":""},{"path":"https://sebkrantz.github.io/flownet/articles/introduction.html","id":"probability-formula","dir":"Articles","previous_headings":"Key Concepts and Functions > Path-Sized Logit Model","what":"Probability Formula","title":"Introduction to flownet","text":"probability P_k choosing route k set alternative routes K given : P_k = \\frac{e^{V_k}}{\\sum_{j \\K} e^{V_j}} V_k deterministic utility route k, defined flownet : V_k = -C_k + \\beta_{PSL} \\ln(PS_k) : - C_k generalized cost route k. - \\beta_{PSL} path-sized logit parameter (controlled beta argument). - PS_k Path-Size factor route k.","code":""},{"path":"https://sebkrantz.github.io/flownet/articles/introduction.html","id":"the-correction-term-path-size-factor-ps_k","dir":"Articles","previous_headings":"Key Concepts and Functions > Path-Sized Logit Model","what":"The Correction Term: Path-Size Factor (PS_k)","title":"Introduction to flownet","text":"Path-Size factor PS_k quantifies uniqueness route k. defined ratio length (cost) links path k number alternatives sharing links. formula implemented flownet : PS_k = \\frac{1}{C_k} \\sum_{\\\\Gamma_k} \\frac{c_a}{\\delta_a} : - \\Gamma_k set edges path k. - c_a cost edge . - C_k = \\sum_{\\\\Gamma_k} c_a total cost path k. - \\delta_a number alternative routes choice set K use edge . Interpretation: - path completely unique (\\delta_a = 1 edges), PS_k = 1 \\ln(PS_k) = 0. utility reduces standard MNL utility (V_k = -C_k). - path shares edges many routes (\\delta_a > 1), PS_k < 1 \\ln(PS_k) < 0. - term \\beta_{PSL} \\ln(PS_k) acts correction. Since \\ln(PS_k) negative overlapping routes, positive \\beta_{PSL} (default 1) required ensure overlapping paths lower utility (penalization). formulation ensures model assigns lower probabilities routes largely duplicates others, distributing flow realistically across truly distinct alternatives. practice, value \\beta_{PSL} = 1 sensible default; higher values strengthen penalization overlapping routes lower values make model behave like standard MNL.","code":""},{"path":"https://sebkrantz.github.io/flownet/articles/introduction.html","id":"network-processing-functions","dir":"Articles","previous_headings":"Key Concepts and Functions","what":"Network Processing Functions","title":"Introduction to flownet","text":"linestrings_to_graph(): Converts LINESTRING geometries graph data frame format. typically first step working spatial network data. linestrings_from_graph(): Converts graph data frame back LINESTRING geometries. Useful visualization spatial operations. create_undirected_graph(): Converts directed graph undirected graph normalizing edge directions aggregating duplicate connections. Useful transport links can traversed directions. consolidate_graph(): Simplifies network topology removing intermediate nodes merging connecting edges. can significantly reduce computational complexity preserving connectivity. simplify_network(): Simplifies network using one two methods: shortest-paths: Keeps edges traversed shortest paths specified nodes cluster: Spatially clusters nodes using leaderCluster algorithm contracts graph","code":""},{"path":"https://sebkrantz.github.io/flownet/articles/introduction.html","id":"graph-utilities","dir":"Articles","previous_headings":"Key Concepts and Functions","what":"Graph Utilities","title":"Introduction to flownet","text":"nodes_from_graph(): Extracts unique nodes coordinates graph. Essential mapping zone centroids network nodes. normalize_graph(): Normalizes node IDs consecutive integers starting 1. can improve performance graph algorithms. distances_from_graph(): Computes distance matrix node pairs using graph structure.","code":""},{"path":"https://sebkrantz.github.io/flownet/articles/introduction.html","id":"od-matrix-utilities","dir":"Articles","previous_headings":"Key Concepts and Functions","what":"OD Matrix Utilities","title":"Introduction to flownet","text":"melt_od_matrix(): Converts origin-destination matrix long format columns , , flow. format required run_assignment().","code":""},{"path":"https://sebkrantz.github.io/flownet/articles/introduction.html","id":"traffic-assignment","dir":"Articles","previous_headings":"Key Concepts and Functions","what":"Traffic Assignment","title":"Introduction to flownet","text":"run_assignment(): core function traffic assignment. Key parameters: method: “PSL” (path-sized logit) “AoN” (--nothing). AoN faster doesn’t account route overlap. beta (default: 1): Path-sized logit parameter. positive value penalizes overlapping routes. detour.max (default: 1.5): Maximum detour factor alternative routes. Higher values consider routes increase computation time substantially. angle.max (default: 90): Maximum detour angle degrees. Routes outside angle straight line origin destination considered. cost.column: cost column use route computation. Can column name numeric vector. return.extra: Additional results return, paths, edge counts, distance matrices.","code":""},{"path":"https://sebkrantz.github.io/flownet/articles/introduction.html","id":"parameter-tuning-tips","dir":"Articles","previous_headings":"Key Concepts and Functions","what":"Parameter Tuning Tips","title":"Introduction to flownet","text":"detour.max: Start default (1.5) increase need consider alternative routes. aware higher values can dramatically increase computation time. angle.max: Use restrict route enumeration direct paths. Smaller values (e.g., 45°) can significantly speed computation large networks. beta: path-sized logit parameter. Typically positive (default 1) penalize route overlap; values larger 1 increase penalty overlapping routes, values 0 1 make model closer standard MNL.","code":""},{"path":"https://sebkrantz.github.io/flownet/articles/introduction.html","id":"conclusion","dir":"Articles","previous_headings":"","what":"Conclusion","title":"Introduction to flownet","text":"vignette demonstrated basic advanced workflows using flownet package: Basic workflow: Convert network graph, map zones nodes, create OD matrix, run traffic assignment Trade flow disaggregation: Distribute country-level trade city-level flows using population shares Network consolidation: Process raw segments consolidation simplification efficient computation package provides efficient tools transport modeling path-sized logit model, accounting route overlap traffic assignment. network processing utilities allow prepare simplify networks efficient computation.","code":""},{"path":"https://sebkrantz.github.io/flownet/articles/introduction.html","id":"next-steps","dir":"Articles","previous_headings":"Conclusion","what":"Next Steps","title":"Introduction to flownet","text":"Explore full function documentation: ?flownet-package Experiment different parameter values (beta, detour.max, angle.max) Try PSL method instead AoN smaller networks subsets Use africa_trade explore trade patterns different HS sections Experiment simplify_network() cluster method coarser network representations information, see package documentation examples help files individual functions.","code":""},{"path":"https://sebkrantz.github.io/flownet/authors.html","id":null,"dir":"","previous_headings":"","what":"Authors","title":"Authors and Citation","text":"Sebastian Krantz. Author, maintainer. Kamol Roy. Contributor.","code":""},{"path":"https://sebkrantz.github.io/flownet/authors.html","id":"citation","dir":"","previous_headings":"","what":"Citation","title":"Authors and Citation","text":"Krantz S (2026). flownet: Transport Modeling: Network Processing, Route Enumeration, Traffic Assignment. R package version 0.1.0, https://sebkrantz.github.io/flownet/.","code":"@Manual{,   title = {flownet: Transport Modeling: Network Processing, Route Enumeration, and Traffic Assignment},   author = {Sebastian Krantz},   year = {2026},   note = {R package version 0.1.0},   url = {https://sebkrantz.github.io/flownet/}, }"},{"path":"https://sebkrantz.github.io/flownet/index.html","id":"flownet","dir":"","previous_headings":"","what":"Transport Modeling in R","title":"Transport Modeling in R","text":"Transport Modeling: Network Processing, Route Enumeration, Traffic Assignment flownet provides efficient tools transportation modeling R, supporting network processing, route enumeration, traffic assignment tasks. implements path-sized logit (PSL) model traffic assignment provides powerful utilities network processing/preparation.","code":""},{"path":"https://sebkrantz.github.io/flownet/index.html","id":"key-features","dir":"","previous_headings":"","what":"Key Features","title":"Transport Modeling in R","text":"Path-Sized Logit Model: Stochastic traffic assignment accounting route overlap Network Processing: Convert LINESTRING geometries network graphs consolidate/simplify Route Enumeration: Efficient algorithm finding alternative routes origin-destination pairs High Performance: fastverse packages custom C implementations critical path operations Multithreading: Asynchronous parallelism using mirai faster processing large networks","code":""},{"path":"https://sebkrantz.github.io/flownet/index.html","id":"installation","dir":"","previous_headings":"","what":"Installation","title":"Transport Modeling in R","text":"","code":"# Install from R-universe (recommended) install.packages(\"flownet\", repos = c(\"https://sebkrantz.r-universe.dev\", getOption(\"repos\")))  # Or install development version from GitHub remotes::install_github(\"SebKrantz/flownet\")"},{"path":"https://sebkrantz.github.io/flownet/index.html","id":"dependencies","dir":"","previous_headings":"Installation","what":"Dependencies","title":"Transport Modeling in R","text":"collapse (>= 2.1.5) - Fast data transformations memory efficient programming kit (>= 0.0.5) - Fast tabulation vectorized switches igraph (>= 2.1.4) - Graph operations shortest path algorithms sf (>= 1.0.0) - Spatial data handling geodist (>= 0.1.1) - Fast geodesic distance computations leaderCluster (>= 0.3.0) - Fast spatial clustering network simplification mirai (>= 2.5.2) - Asynchronous parallelism R progress (>= 1.2.3) - Progress bars long-running operations","code":""},{"path":"https://sebkrantz.github.io/flownet/index.html","id":"quick-start","dir":"","previous_headings":"","what":"Quick Start","title":"Transport Modeling in R","text":"provide boilerplate code. See also introductory vignette richer examples.","code":""},{"path":"https://sebkrantz.github.io/flownet/index.html","id":"basic-usage","dir":"","previous_headings":"Quick Start","what":"Basic Usage","title":"Transport Modeling in R","text":"","code":"library(flownet)  # Create a small graph data frame graph <- data.frame(from = c(1, 2, 2, 3),                     to = c(2, 3, 4, 4), cost = c(5, 3, 2, 4))  # Prepare OD matrix with the same node IDs as in graph od_matrix_long <- data.frame(from = c(1, 2, 3),                              to = c(4, 4, 4), flow = c(100, 80, 60))  # Run traffic assignment (and route enumeration) result <- run_assignment(graph, od_matrix_long, angle.max = NA) #> Created graph with 4 nodes and 4 edges... #> Computed distance matrix of dimensions 4 x 4 ...  # Access results result$final_flows #> [1] 100.00000  16.13649 196.13649  43.86351"},{"path":"https://sebkrantz.github.io/flownet/index.html","id":"working-with-spatial-networks","dir":"","previous_headings":"Quick Start","what":"Working with Spatial Networks","title":"Transport Modeling in R","text":"","code":"library(flownet) library(sf)  # Read network from shapefile and create undirected graph (optional) graph <- st_read(\"data/network.shp\") |>    linestrings_to_graph() |>   create_undirected_graph()  # Read zone centroids and get nearest nodes od_zones <- st_read(\"data/od_zones.shp\") |> st_centroid() nodes <- nodes_from_graph(graph, sf = TRUE) nearest_nodes <- nodes$node[st_nearest_feature(od_zones, nodes)]  # Consolidate Graph (optional) graph <- consolidate_graph(graph, keep = nearest_nodes, w = ~ cost)  # Simplify network by keeping only traversed edges along shortest paths (optional) # Use 'by' for multimodal networks to compute paths separately per mode graph <- simplify_network(graph, nearest_nodes, cost.column = \"cost\", by = ~ mode)"},{"path":"https://sebkrantz.github.io/flownet/index.html","id":"example-workflow","dir":"","previous_headings":"Quick Start","what":"Example Workflow","title":"Transport Modeling in R","text":"","code":"library(fastverse) fastverse_extend(flownet, sf, mapview)  # 1. Load network and OD zone nodes network <- st_read(\"data/network.shp\") od_zones <- st_read(\"data/od_zones.shp\") |> st_centroid() od_matrix <- fread(\"data/od_container_flows.csv\") |> qM(1) if(!all(dim(od_matrix) == nrow(od_zones))) stop(\"zones and OD matrix must match\")  # 2. Convert network to graph graph <- network |>   linestrings_to_graph() |>   create_undirected_graph()  # 3. Map zones to nearest network nodes nodes <- nodes_from_graph(graph, sf = TRUE) nearest_nodes <- nodes$node[st_nearest_feature(od_zones, nodes)]  # 4. Prepare OD matrix od_matrix_long <- melt_od_matrix(od_matrix, nodes = nearest_nodes)  # 5. Run assignment result <- run_assignment(graph, od_matrix_long, cost.column = \"cost_column\")  # 6. Visualize results (optional) network$final_flows <- NA_real_ network$final_flows[attr(graph, \"group.starts\")] <- result$final_flows mapview(network, zcol = \"final_flows\")"},{"path":"https://sebkrantz.github.io/flownet/index.html","id":"included-data","dir":"","previous_headings":"Quick Start","what":"Included Data","title":"Transport Modeling in R","text":"package includes four example datasets Africa: africa_network: road transport network 2,825 LINESTRING features representing existing roads (2,344 edges) proposed new links (481 edges). edge includes attributes distance, travel duration, border crossing costs, terrain ruggedness, road upgrade costs. africa_cities_ports: 453 African cities population > 100,000 international ports. Includes population data, capital status, port cargo outflows. africa_segments: 14,358 raw network segments representing intersected road routes. Useful demonstrating network consolidation simplification functions. africa_trade: Bilateral trade flows 47 African countries aggregated HS section (21 product categories). Values represent annual averages 2012-2022. africa_network, africa_cities_ports, africa_segments datasets Krantz, S. (2024). Optimal Investments Africa’s Road Network. Policy Research Working Paper 10893. World Bank. Replication materials available github.com/SebKrantz/OptimalAfricanRoads.","code":""},{"path":[]},{"path":"https://sebkrantz.github.io/flownet/index.html","id":"traffic-assignment-and-route-enumeration","dir":"","previous_headings":"Main Functions","what":"Traffic Assignment and Route Enumeration","title":"Transport Modeling in R","text":"Iterates OD-pairs generating sensible alternative routes Assigns traffic flows network edges using path-sized logit model Supports directed undirected graphs Returns flows optional path/route information beta (default: 1): Path-sized logit parameter (beta_PSL) detour.max (default: 1.5): Maximum detour factor alternative routes. Higher values consider routes increase computation time angle.max (default: 90): Maximum detour angle degrees (two-sided) return.extra: Additional results return route enumeration stage (\"paths\", \"edges\", \"counts\", \"costs\", \"weights\")","code":""},{"path":"https://sebkrantz.github.io/flownet/index.html","id":"network-processing","dir":"","previous_headings":"Main Functions","what":"Network Processing","title":"Transport Modeling in R","text":"linestrings_to_graph() - Convert LINESTRING geometries graph data frame create_undirected_graph() - Convert directed graph undirected edge aggregation consolidate_graph() - Consolidate graph removing intermediate nodes merging edges simplify_network() - Simplify network using shortest-paths spatial clustering methods","code":""},{"path":"https://sebkrantz.github.io/flownet/index.html","id":"graph-utilities","dir":"","previous_headings":"Main Functions","what":"Graph Utilities","title":"Transport Modeling in R","text":"nodes_from_graph() - Extract unique nodes coordinates graph normalize_graph() - Normalize node IDs consecutive integers starting 1 linestrings_from_graph() - Convert graph LINESTRING geometries distances_from_graph() - Compute distance matrix node pairs","code":""},{"path":"https://sebkrantz.github.io/flownet/index.html","id":"od-matrix-utilities","dir":"","previous_headings":"Main Functions","what":"OD Matrix Utilities","title":"Transport Modeling in R","text":"melt_od_matrix() - Convert origin-destination matrices long format","code":""},{"path":"https://sebkrantz.github.io/flownet/index.html","id":"authors","dir":"","previous_headings":"","what":"Authors","title":"Transport Modeling in R","text":"Sebastian Krantz Kamol Roy","code":""},{"path":"https://sebkrantz.github.io/flownet/index.html","id":"license","dir":"","previous_headings":"","what":"License","title":"Transport Modeling in R","text":"GPL-3","code":""},{"path":"https://sebkrantz.github.io/flownet/index.html","id":"citation","dir":"","previous_headings":"","what":"Citation","title":"Transport Modeling in R","text":"use flownet research, please cite:","code":"citation(\"flownet\")"},{"path":"https://sebkrantz.github.io/flownet/reference/africa_cities_ports.html","id":null,"dir":"Reference","previous_headings":"","what":"African Cities and International Ports — africa_cities_ports","title":"African Cities and International Ports — africa_cities_ports","text":"spatial dataset containing 453 major African cities (population > 100,000) international ports. Cities deduplicated within 50-100km radii, populations aggregated nearby settlements. Port cities include cargo flow data World Bank Global Ports dataset.","code":""},{"path":"https://sebkrantz.github.io/flownet/reference/africa_cities_ports.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"African Cities and International Ports — africa_cities_ports","text":"","code":"data(africa_cities_ports)"},{"path":"https://sebkrantz.github.io/flownet/reference/africa_cities_ports.html","id":"format","dir":"Reference","previous_headings":"","what":"Format","title":"African Cities and International Ports — africa_cities_ports","text":"Simple feature collection (sf object, also inheriting data.table) 453 POINT features 12 fields: city_country Character. Unique city-country identifier (e.g., \"Cairo - Egypt\", \"Lagos - Nigeria\"). city Character. City name. country Character. Country name. iso2 Character. ISO 3166-1 alpha-2 country code. iso3 Character. ISO 3166-1 alpha-3 country code. admin_name Character. Administrative region province name. capital Character. Capital status: \"\" (none), \"admin\" (administrative), \"minor\", \"primary\" (national capital). population Numeric. City population including nearby settlements within 30km. port_locode Character. UN/LOCODE port identifier (empty string non-port cities). port_name Character. Official port name (empty string non-port cities). port_status Character. Port status code (empty string non-port cities). outflows Numeric. Outflows TEU Q1 2020 (NA non-port cities). 51 cities port outflow data. geometry POINT. Spatial geometry WGS 84 (EPSG:4326) coordinate reference system.","code":""},{"path":"https://sebkrantz.github.io/flownet/reference/africa_cities_ports.html","id":"source","dir":"Reference","previous_headings":"","what":"Source","title":"African Cities and International Ports — africa_cities_ports","text":"City data Simplemaps World Cities Database (https://simplemaps.com/data/world-cities). Port data World Bank Global International Ports dataset (https://datacatalog.worldbank.org/search/dataset/0038118). Dataset constructed : Krantz, S. (2024). Optimal Investments Africa's Road Network. Policy Research Working Paper 10893. World Bank. doi:10.1596/1813-9450-10893 . Replication materials: https://github.com/SebKrantz/OptimalAfricanRoads.","code":""},{"path":"https://sebkrantz.github.io/flownet/reference/africa_cities_ports.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"African Cities and International Ports — africa_cities_ports","text":"dataset constructed : Selecting cities population > 50,000 Simplemaps World Cities database Weighting administrative importance (capital status) Deduplicating within 50-100km radii, keeping largest weighted city Aggregating populations settlements within 30km Matching World Bank international ports within 30km bounding box spans approximately 34S 37N latitude 17W 49E longitude, covering continental Africa.","code":""},{"path":[]},{"path":"https://sebkrantz.github.io/flownet/reference/africa_cities_ports.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"African Cities and International Ports — africa_cities_ports","text":"","code":"library(sf) #> Linking to GEOS 3.12.1, GDAL 3.8.4, PROJ 9.4.0; sf_use_s2() is TRUE data(africa_cities_ports) head(africa_cities_ports) #> Simple feature collection with 6 features and 12 fields #> Geometry type: POINT #> Dimension:     XY #> Bounding box:  xmin: 3.3841 ymin: -26.2044 xmax: 39.2803 ymax: 30.0444 #> Geodetic CRS:  WGS 84 #>                  city_country          city          country iso2 iso3 #> 1               Cairo - Egypt         Cairo            Egypt   EG  EGY #> 2             Lagos - Nigeria         Lagos          Nigeria   NG  NGA #> 3 Kinshasa - Congo (Kinshasa)      Kinshasa Congo (Kinshasa)   CD  COD #> 4             Luanda - Angola        Luanda           Angola   AO  AGO #> 5 Johannesburg - South Africa  Johannesburg     South Africa   ZA  ZAF #> 6    Dar es Salaam - Tanzania Dar es Salaam         Tanzania   TZ  TZA #>      admin_name capital population port_locode     port_name port_status #> 1    Al Qahirah primary   28621082                                       #> 2         Lagos   minor   19932062       NGAPP         Apapa          QQ #> 3      Kinshasa primary   16579488                                       #> 4        Luanda primary   12376210       AOLAD        Luanda          AI #> 5       Gauteng   admin   12282763                                       #> 6 Dar es Salaam   admin    9048912       TZDAR Dar es Salaam          AI #>   outflows                 geometry #> 1       NA  POINT (31.2358 30.0444) #> 2  3749556     POINT (3.3841 6.455) #> 3       NA  POINT (15.3119 -4.3219) #> 4  2439605  POINT (13.2344 -8.8383) #> 5       NA POINT (28.0456 -26.2044) #> 6  1404404  POINT (39.2803 -6.8161)  # View largest cities largest <- africa_cities_ports[order(-africa_cities_ports$population), ] largest[1:10, c(\"city\", \"country\", \"population\")] #> Simple feature collection with 10 features and 3 fields #> Geometry type: POINT #> Dimension:     XY #> Bounding box:  xmin: -4.0333 ymin: -26.2044 xmax: 39.2803 ymax: 30.0444 #> Geodetic CRS:  WGS 84 #>             city          country population                 geometry #> 1          Cairo            Egypt   28621082  POINT (31.2358 30.0444) #> 2          Lagos          Nigeria   19932062     POINT (3.3841 6.455) #> 3       Kinshasa Congo (Kinshasa)   16579488  POINT (15.3119 -4.3219) #> 4         Luanda           Angola   12376210  POINT (13.2344 -8.8383) #> 5   Johannesburg     South Africa   12282763 POINT (28.0456 -26.2044) #> 7       Khartoum            Sudan   11610745        POINT (32.5 15.6) #> 6  Dar es Salaam         Tanzania    9048912  POINT (39.2803 -6.8161) #> 10       Abidjan    Cote d'Ivoire    9022419   POINT (-4.0333 5.3167) #> 17        Kumasi            Ghana    6898949       POINT (-1.625 6.7) #> 9        Nairobi            Kenya    6527382  POINT (36.8172 -1.2864)  # Filter port cities ports <- africa_cities_ports[!is.na(africa_cities_ports$port_locode), ] nrow(ports)  # 51 ports #> [1] 453  if (FALSE) { # \\dontrun{ plot(africa_cities_ports[\"population\"]) } # }"},{"path":"https://sebkrantz.github.io/flownet/reference/africa_network.html","id":null,"dir":"Reference","previous_headings":"","what":"Trans-African Road Transport Network — africa_network","title":"Trans-African Road Transport Network — africa_network","text":"spatial dataset representing discretized road transport network connecting major African cities ports. network combines existing road infrastructure (2,344 edges) proposed new links (481 edges) identified network efficiency analysis. edge contains distance, travel time, border crossing costs, terrain characteristics, road upgrade cost estimates.","code":""},{"path":"https://sebkrantz.github.io/flownet/reference/africa_network.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Trans-African Road Transport Network — africa_network","text":"","code":"data(africa_network)"},{"path":"https://sebkrantz.github.io/flownet/reference/africa_network.html","id":"format","dir":"Reference","previous_headings":"","what":"Format","title":"Trans-African Road Transport Network — africa_network","text":"Simple feature collection (sf object) 2,825 LINESTRING features 28 fields: Integer. Origin node index (1 1,377). Integer. Destination node index (2 1,379). from_ctry Character. Origin country ISO3 code (49 countries). to_ctry Character. Destination country ISO3 code (49 countries). FX Numeric. Origin node longitude. FY Numeric. Origin node latitude. TX Numeric. Destination node longitude. TY Numeric. Destination node latitude. sp_distance Numeric. Spherical (great-circle) distance meters. distance Numeric. Road distance meters OSRM routing. duration Numeric. Travel duration minutes OSRM routing (NA proposed links). speed_kmh Numeric. Average speed km/h (distance/duration) (NA proposed links). passes Numeric. Number optimal inter-city routes passing edge (NA proposed links). gravity Numeric. Sum population gravity weights routes using edge (NA proposed links). gravity_rd Numeric. Sum road-distance-weighted gravity routes (NA proposed links). border_dist Numeric. Additional distance border crossing meters (0 domestic links). total_dist Numeric. Total distance including border crossing penalty meters. border_time Numeric. Additional time border crossing minutes. total_time Numeric. Total travel time including border crossing minutes. duration_100kmh Numeric. Hypothetical travel time 100 km/h minutes. total_time_100kmh Numeric. Hypothetical total time 100 km/h including border penalties. rugg Numeric. Terrain ruggedness index along edge. pop_wpop Numeric. Population within corridor (WorldPop data). pop_wpop_km2 Numeric. Population density per km2 along corridor. cost_km Numeric. Estimated road construction/maintenance cost per km USD. upgrade_cat Character. Road upgrade category: \"Nothing\", \"Asphalt Mix Resurfacing\", \"Mixed Works\", \"Upgrade\", NA. ug_cost_km Numeric. Upgrade cost per km USD. add Logical. TRUE proposed new links, FALSE existing road network edges. geometry LINESTRING. Spatial geometry WGS 84 (EPSG:4326) coordinate reference system.","code":""},{"path":"https://sebkrantz.github.io/flownet/reference/africa_network.html","id":"source","dir":"Reference","previous_headings":"","what":"Source","title":"Trans-African Road Transport Network — africa_network","text":"Road network derived OpenStreetMap via OSRM routing. Border crossing data World Bank estimates. Terrain data SRTM elevation models. Population data WorldPop. Dataset constructed : Krantz, S. (2024). Optimal Investments Africa's Road Network. Policy Research Working Paper 10893. World Bank. doi:10.1596/1813-9450-10893 . Replication materials: https://github.com/SebKrantz/OptimalAfricanRoads.","code":""},{"path":"https://sebkrantz.github.io/flownet/reference/africa_network.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Trans-African Road Transport Network — africa_network","text":"network constructed following process: Computing optimal routes city pairs within 2,000km using OSRM Filtering routes using network efficiency criteria (alpha = 45 degrees, EU-grade efficiency) Intersecting aggregating overlapping route segments Contracting network reduce complexity preserving connectivity Identifying proposed new links improve network route efficiency Adding border crossing costs based country pairs Computing terrain, population, road cost attributes gravity gravity_rd fields measure edge importance based population gravity model: routes larger, closer cities contribute weight edges traverse. bounding box spans continental Africa approximately 34S 37N latitude 17W 49E longitude.","code":""},{"path":[]},{"path":"https://sebkrantz.github.io/flownet/reference/africa_network.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Trans-African Road Transport Network — africa_network","text":"","code":"library(sf) data(africa_network) head(africa_network) #> Simple feature collection with 6 features and 28 fields #> Geometry type: LINESTRING #> Dimension:     XY #> Bounding box:  xmin: -17.44671 ymin: 14.34236 xmax: -16.24391 ymax: 15.63569 #> Geodetic CRS:  WGS 84 #>   from to from_ctry to_ctry        FX       FY        TX       TY sp_distance #> 1    1  2       SEN     SEN -17.44671 14.69281 -17.04453 14.70297    43272.22 #> 2    2  3       SEN     SEN -17.04453 14.70297 -16.63849 15.11222    63043.01 #> 3    2  4       SEN     SEN -17.04453 14.70297 -16.46332 14.75651    62786.56 #> 4    2  5       SEN     SEN -17.04453 14.70297 -16.42054 14.34236    78226.09 #> 5    3  4       SEN     SEN -16.63849 15.11222 -16.46332 14.75651    43802.37 #> 6    3 10       SEN     SEN -16.63849 15.11222 -16.24391 15.63569    71956.96 #>   distance duration speed_kmh   passes     gravity  gravity_rd border_dist #> 1  65988.0    46.15  85.79155 104.3333 215.3302926 157.5228265           0 #> 2  87290.5    72.25  72.49038  10.0000  20.1382178  14.7376257           0 #> 3  89469.5    61.10  87.85876   1.5000  11.6420372  10.5577017           0 #> 4  99998.0    72.90  82.30288  55.0000 122.2011739  88.0080152           0 #> 5  61111.5    72.90  50.29753   1.0000   0.5259515   0.3953356           0 #> 6  73391.0    61.20  71.95196  31.0000  23.0342955  16.8520354           0 #>   total_dist border_time total_time duration_100kmh total_time_100kmh      rugg #> 1    65988.0           0      46.15         39.5928           39.5928 25203.645 #> 2    87290.5           0      72.25         52.3743           52.3743 23656.895 #> 3    89469.5           0      61.10         53.6817           53.6817 25761.240 #> 4    99998.0           0      72.90         59.9988           59.9988 24773.338 #> 5    61111.5           0      72.90         36.6669           36.6669 11331.973 #> 6    73391.0           0      61.20         44.0346           44.0346  1745.889 #>    pop_wpop pop_wpop_km2  cost_km             upgrade_cat ug_cost_km   add #> 1 670689.38    2262.9802 699437.0 Asphalt Mix Resurfacing   165533.4 FALSE #> 2 191412.11     450.2150 605210.4             Mixed Works   325804.9 FALSE #> 3 177027.86     415.0577 607229.6 Asphalt Mix Resurfacing   143711.0 FALSE #> 4 137874.58     262.0664 581289.6 Asphalt Mix Resurfacing   137571.9 FALSE #> 5  65316.04     216.0512 520634.9                 Upgrade   440804.2 FALSE #> 6 102835.91     212.9464 415457.6             Mixed Works   223654.7 FALSE #>                         geometry #> 1 LINESTRING (-17.44671 14.69... #> 2 LINESTRING (-17.04453 14.70... #> 3 LINESTRING (-17.04453 14.70... #> 4 LINESTRING (-17.04453 14.70... #> 5 LINESTRING (-16.63849 15.11... #> 6 LINESTRING (-16.63849 15.11...  # Existing vs proposed links table(africa_network$add) #>  #> FALSE  TRUE  #>  2344   481   # Cross-border links cross_border <- africa_network[africa_network$from_ctry != africa_network$to_ctry, ] nrow(cross_border) #> [1] 457  # Upgrade categories table(africa_network$upgrade_cat, useNA = \"ifany\") #>  #> Asphalt Mix Resurfacing             Mixed Works                 Nothing  #>                     628                     901                       5  #>                 Upgrade                    <NA>  #>                     810                     481   if (FALSE) { # \\dontrun{ # Plot by gravity plot(africa_network[\"gravity_rd\"])  # Highlight proposed new links plot(africa_network[africa_network$add, \"geometry\"], col = \"red\", add = TRUE) } # }"},{"path":"https://sebkrantz.github.io/flownet/reference/africa_segments.html","id":null,"dir":"Reference","previous_headings":"","what":"Raw Network Segments for Trans-African Transport Network — africa_segments","title":"Raw Network Segments for Trans-African Transport Network — africa_segments","text":"dataset containing 14,358 raw network segments representing intersected road routes African cities. segment defined start end coordinates aggregate importance metrics. dataset provided demonstrate package functions like consolidate_graph() simplify_network() can process messy segment data clean analytical networks like africa_network.","code":""},{"path":"https://sebkrantz.github.io/flownet/reference/africa_segments.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Raw Network Segments for Trans-African Transport Network — africa_segments","text":"","code":"data(africa_segments)"},{"path":"https://sebkrantz.github.io/flownet/reference/africa_segments.html","id":"format","dir":"Reference","previous_headings":"","what":"Format","title":"Raw Network Segments for Trans-African Transport Network — africa_segments","text":"data frame 14,358 rows 7 columns: FX Numeric. Start point longitude (range: -17.4 49.2). FY Numeric. Start point latitude (range: -34.2 37.2). TX Numeric. End point longitude (range: -17.0 49.1). TY Numeric. End point latitude (range: -34.2 37.2). passes Integer. Number optimal inter-city routes passing segment.     Range: 1 1,615, median: 46. gravity Numeric. Sum population gravity weights routes using segment.     Computed sum (pop_origin * pop_destination / spherical_distance_km) / 1e9. gravity_rd Numeric. Sum road-distance-weighted gravity routes.     Computed sum (pop_origin * pop_destination / road_distance_m) / 1e9.","code":""},{"path":"https://sebkrantz.github.io/flownet/reference/africa_segments.html","id":"source","dir":"Reference","previous_headings":"","what":"Source","title":"Raw Network Segments for Trans-African Transport Network — africa_segments","text":"Derived OpenStreetMap routing data via OSRM, processed route intersection aggregation. Dataset constructed : Krantz, S. (2024). Optimal Investments Africa's Road Network. Policy Research Working Paper 10893. World Bank. doi:10.1596/1813-9450-10893 . Replication materials: https://github.com/SebKrantz/OptimalAfricanRoads.","code":""},{"path":"https://sebkrantz.github.io/flownet/reference/africa_segments.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Raw Network Segments for Trans-African Transport Network — africa_segments","text":"dataset represents intermediate stage network construction, routes intersected network simplification. segments simplified using linestrings_from_graph() retain start end coordinates. segments can used demonstrate flownet network processing workflow: Convert segments sf LINESTRING object using linestrings_from_graph() Apply consolidate_graph() merge nearby nodes Apply simplify_network() remove intermediate nodes passes field indicates many optimal city--city routes use segment, serving measure segment importance network. Higher values indicate segments critical efficient inter-city connectivity.","code":""},{"path":[]},{"path":"https://sebkrantz.github.io/flownet/reference/africa_segments.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Raw Network Segments for Trans-African Transport Network — africa_segments","text":"","code":"data(africa_segments) head(africa_segments) #>          FX       FY        TX       TY passes  gravity gravity_rd #> 1 -17.44759 14.69386 -17.04861 14.70538     59 93.20669  67.218731 #> 2 -17.44759 14.69386 -16.70998 14.40844      6 59.98582  45.491608 #> 3 -17.04861 14.70538 -16.70998 14.40844     48 61.68941  42.121072 #> 4 -17.04861 14.70538 -16.96602 14.72614     11 31.51728  25.097660 #> 5 -17.03345 20.93362 -16.89503 21.28569     63  4.09779   2.981159 #> 6 -16.96602 14.72614 -16.63849 15.11222     10 20.13822  14.737626  # Summary statistics summary(africa_segments[, c(\"passes\", \"gravity\", \"gravity_rd\")]) #>      passes          gravity            gravity_rd        #>  Min.   :   1.0   Min.   :   0.0001   Min.   :   0.0001   #>  1st Qu.:  14.0   1st Qu.:   3.9964   1st Qu.:   2.8740   #>  Median :  46.0   Median :  16.5966   Median :  11.4518   #>  Mean   : 113.9   Mean   :  76.2857   Mean   :  53.9421   #>  3rd Qu.: 131.0   3rd Qu.:  64.4550   3rd Qu.:  43.4980   #>  Max.   :1615.0   Max.   :4144.5363   Max.   :3278.1380    # Segments with highest traffic africa_segments[order(-africa_segments$passes), ][1:10, ] #>             FX       FY       TX       TY passes  gravity gravity_rd #> 672   -0.43130 12.19363 -0.35795 12.18282   1615 654.6566   483.7826 #> 5829  -1.52978 12.36658 -1.52187 12.37092   1584 646.9655   478.4648 #> 5830  -1.52187 12.37092 -1.51004 12.37915   1584 646.9655   478.4648 #> 649   -1.36024 12.43948 -1.26867 12.48558   1581 649.2992   480.4201 #> 651   -1.26432 12.48681 -0.43130 12.19363   1574 645.7477   477.1712 #> 647   -1.44519 12.39922 -1.37384 12.43304   1570 646.5881   478.1731 #> 641   -1.53359 12.36966 -1.52978 12.36658   1536 584.3362   435.5978 #> 5713  -2.01904 12.19641 -1.75856 12.23416   1437 564.3777   415.2477 #> 5714  -1.75503 12.23701 -1.63531 12.32471   1437 564.3777   415.2477 #> 13627 35.69371 -0.15936 35.70070 -0.16562   1395 496.1546   353.6817  if (FALSE) { # \\dontrun{ # Convert to sf and plot library(sf) segments_sf <- linestrings_from_graph(africa_segments) plot(segments_sf[\"passes\"]) } # }"},{"path":"https://sebkrantz.github.io/flownet/reference/africa_trade.html","id":null,"dir":"Reference","previous_headings":"","what":"Intra-African Trade Flows by HS Section — africa_trade","title":"Intra-African Trade Flows by HS Section — africa_trade","text":"dataset containing bilateral trade flows 47 African countries, aggregated HS (Harmonized System) section. Values represent annual averages 2012-2022 CEPII BACI database (HS96 nomenclature).","code":""},{"path":"https://sebkrantz.github.io/flownet/reference/africa_trade.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Intra-African Trade Flows by HS Section — africa_trade","text":"","code":"data(africa_trade)"},{"path":"https://sebkrantz.github.io/flownet/reference/africa_trade.html","id":"format","dir":"Reference","previous_headings":"","what":"Format","title":"Intra-African Trade Flows by HS Section — africa_trade","text":"data.table 27,721 rows 8 columns: iso3_o Factor. Exporter (origin) country ISO 3166-1 alpha-3 code (47 countries). iso3_d Factor. Importer (destination) country ISO 3166-1 alpha-3 code (47 countries). section_code Integer. HS section code (1 21). section_name Factor. HS section description (21 categories, e.g.,     \"Live animals animal products\", \"Mineral products\", \"Machinery mechanical appliances...\"). hs2_codes Factor. Comma-separated HS 2-digit codes within section     (e.g., \"84, 85\" machinery). value Numeric. Trade value thousands USD (current prices). value_kd Numeric. Trade value thousands constant 2015 USD. quantity Numeric. Trade quantity metric tons.","code":""},{"path":"https://sebkrantz.github.io/flownet/reference/africa_trade.html","id":"source","dir":"Reference","previous_headings":"","what":"Source","title":"Intra-African Trade Flows by HS Section — africa_trade","text":"CEPII BACI Database (HS96 nomenclature), Version 202401b, released 2024-04-09. Available https://www.cepii.fr/DATA_DOWNLOAD/baci/doc/baci_webpage.html. Reference: Gaulier, G. Zignago, S. (2010). BACI: International Trade Database Product-Level. 1994-2007 Version. CEPII Working Paper, N 2010-23.","code":""},{"path":"https://sebkrantz.github.io/flownet/reference/africa_trade.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Intra-African Trade Flows by HS Section — africa_trade","text":"dataset provides bilateral trade flows aggregated HS 6-digit product codes (via HS 2-digit) 21 HS sections. Trade values quantities annual averages computed 2012-2022 period. HS sections cover broad product categories: Sections 1-5: Animal vegetable products Sections 6-7: Chemical plastic products Sections 8-14: Raw materials manufactured goods Sections 15-16: Base metals machinery Sections 17-21: Transport, instruments, miscellaneous Note: country pairs may sparse trade relationships. small values indicate limited trade typical reporting thresholds.","code":""},{"path":[]},{"path":"https://sebkrantz.github.io/flownet/reference/africa_trade.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Intra-African Trade Flows by HS Section — africa_trade","text":"","code":"data(africa_trade) head(africa_trade) #>   iso3_o iso3_d section_code #> 1    AGO    BDI           16 #> 2    AGO    BEN            1 #> 3    AGO    BEN            4 #> 4    AGO    BEN            5 #> 5    AGO    BEN            6 #> 6    AGO    BEN            7 #>                                                                                                                                                                                                  section_name #> 1 Machinery and mechanical appliances, electrical equipment, parts thereof, sound recorders and reproducers, television image and souch recorders and reproducers, and parts and accessories of such articles #> 2                                                                                                                                                                            Live animals and animal products #> 3                                                                                                           Prepared foodstuffs, beverages, spirits and vinegar, tobacco and manufactured tobacco substitutes #> 4                                                                                                                                                                                            Mineral products #> 5                                                                                                                                                               Product of the chemicals or allied industries #> 6                                                                                                                                                  Plastics and articles thereof, rubber and articles thereof #>        hs2_codes     value     value_kd  quantity #> 1             84    5.1040    5.1040000    0.9870 #> 2              3 6810.4528 6527.0068247 8777.0133 #> 3     19, 20, 22    9.5135    9.0984152   20.7370 #> 4             27 3583.7897 3536.4303649 8369.7665 #> 5 30, 32, 33, 34    0.9435    0.9319342    0.0275 #> 6         39, 40   71.2590   71.9540899   31.2510  # Number of trading pairs length(unique(paste(africa_trade$iso3_o, africa_trade$iso3_d))) #> [1] 1971  # Total trade by section aggregate(value ~ section_name, data = africa_trade, FUN = sum) #>                                                                                                                                                                                                    section_name #> 1                                                                                                 Animal or vegetable fats and oils and their cleavage products; prepared edible fats; animal or vegetble waxes #> 2                                                                                                                                                            Arms and ammunition, parts and accessories thereof #> 3                                                                                               Articles of stone, plaster, cement, asbestos, mica, or similar materials, ceramic products, glass and glassware #> 4                                                                                                                                                                        Base metals and articles of base metal #> 5  Footwear, headgear, umbrellas, sun umbrellas, walking-sticks, seat-sticks, whips, riding-crops and parts thereof, prepared feathers and articles made therewith, artificial flowers, articles of human hair. #> 6                                                                                                                                                                              Live animals and animal products #> 7   Machinery and mechanical appliances, electrical equipment, parts thereof, sound recorders and reproducers, television image and souch recorders and reproducers, and parts and accessories of such articles #> 8                                                                                                                                                                                              Mineral products #> 9                                                                                                                                                                           Miscellaneous manufactured articles #> 10                                              Natural or cultured pearls, precious or semi-precious stones, precious metals, metal clad with precious metal, and articles thereof, imitation jewellery, coins #> 11                Optical, photographic, cinematographic, measuring, checking, precision, medical or surgical instruments and apparatus, clocks and watches, musical instruments, parts and accessories thereof #> 12                                                                                                                                                   Plastics and articles thereof, rubber and articles thereof #> 13                                                                                                            Prepared foodstuffs, beverages, spirits and vinegar, tobacco and manufactured tobacco substitutes #> 14                                                                                                                                                                Product of the chemicals or allied industries #> 15                                                             Pulp of wood or of other fibrous cellulosic material, recovered (waste and scrap) paper or paperboard, paper and paperboard and articles thereof #> 16                          Raw hides and skins, leather, furskins and articles thereof, saddlery and harness, travel goods, handbags and similar containers, articles of animal gut (other than silk-worm gut) #> 17                                                                                                                                                                                 Textile and textile articles #> 18                                                                                                                                                                                           Vegetable products #> 19                                                                                                                                               Vehicles, aircraft, vessels and associated transport equipment #> 20                                            Wood and articles of wood, wood charcoal, cork and articles of cork, manufacturers of straw, of esparto or of other plaiting materials, basketwork and wickerwork #> 21                                                                                                                                                                Works of art, collectors' pieces and antiques #>          value #> 1   1613945.96 #> 2    175980.52 #> 3   1323219.72 #> 4   9615324.31 #> 5    492184.56 #> 6   3014069.79 #> 7   7144013.10 #> 8  25996492.65 #> 9    728451.52 #> 10  7376528.86 #> 11   654594.12 #> 12  3019133.56 #> 13  7824476.75 #> 14  9326746.35 #> 15  1753353.32 #> 16   171264.71 #> 17  2415768.17 #> 18  4772233.71 #> 19 12884142.52 #> 20   744624.84 #> 21    63022.15  # Largest bilateral flows africa_trade[order(-africa_trade$value), ][1:10, ] #>       iso3_o iso3_d section_code #> 19294    NGA    ZAF            5 #> 18678    NGA    CIV            5 #> 6977     DZA    TUN            5 #> 664      AGO    ZAF            5 #> 26129    ZAF    MOZ            5 #> 5477     COD    TZA           15 #> 10431    GHA    ZAF           14 #> 25654    ZAF    BWA            5 #> 16026    MOZ    ZAF            5 #> 18764    NGA    DZA            5 #>                                                                                                                                                          section_name #> 19294                                                                                                                                                Mineral products #> 18678                                                                                                                                                Mineral products #> 6977                                                                                                                                                 Mineral products #> 664                                                                                                                                                  Mineral products #> 26129                                                                                                                                                Mineral products #> 5477                                                                                                                           Base metals and articles of base metal #> 10431 Natural or cultured pearls, precious or semi-precious stones, precious metals, metal clad with precious metal, and articles thereof, imitation jewellery, coins #> 25654                                                                                                                                                Mineral products #> 16026                                                                                                                                                Mineral products #> 18764                                                                                                                                                Mineral products #>                                hs2_codes     value  value_kd     quantity #> 19294                         25, 26, 27 3128312.6 3041533.2  5567383.378 #> 18678                         25, 26, 27 1572964.5 1524679.8  2718137.515 #> 6977                              25, 27 1393337.9 1359928.5  1477835.669 #> 664                           25, 26, 27 1204953.6 1198880.0  2473175.036 #> 26129                         25, 26, 27 1150394.2 1064112.0  6965476.414 #> 5477  72, 73, 74, 76, 78, 79, 81, 82, 83 1105493.8 1026106.0   187368.177 #> 10431                                 71 1093580.9 1106132.6      569.086 #> 25654                         25, 26, 27 1014182.6  979699.1  1943577.323 #> 16026                         25, 26, 27  892348.6  861015.7 15235699.239 #> 18764                             26, 27  866681.5  907334.7     6418.847  # Trade between specific countries subset(africa_trade, iso3_o == \"ZAF\" & iso3_d == \"NGA\") #>       iso3_o iso3_d section_code #> 26230    ZAF    NGA            1 #> 26231    ZAF    NGA            2 #> 26232    ZAF    NGA            3 #> 26233    ZAF    NGA            4 #> 26234    ZAF    NGA            5 #> 26235    ZAF    NGA            6 #> 26236    ZAF    NGA            7 #> 26237    ZAF    NGA            8 #> 26238    ZAF    NGA            9 #> 26239    ZAF    NGA           10 #> 26240    ZAF    NGA           11 #> 26241    ZAF    NGA           12 #> 26242    ZAF    NGA           13 #> 26243    ZAF    NGA           14 #> 26244    ZAF    NGA           15 #> 26245    ZAF    NGA           16 #> 26246    ZAF    NGA           17 #> 26247    ZAF    NGA           18 #> 26248    ZAF    NGA           19 #> 26249    ZAF    NGA           20 #> 26250    ZAF    NGA           21 #>                                                                                                                                                                                                       section_name #> 26230                                                                                                                                                                             Live animals and animal products #> 26231                                                                                                                                                                                           Vegetable products #> 26232                                                                                                Animal or vegetable fats and oils and their cleavage products; prepared edible fats; animal or vegetble waxes #> 26233                                                                                                            Prepared foodstuffs, beverages, spirits and vinegar, tobacco and manufactured tobacco substitutes #> 26234                                                                                                                                                                                             Mineral products #> 26235                                                                                                                                                                Product of the chemicals or allied industries #> 26236                                                                                                                                                   Plastics and articles thereof, rubber and articles thereof #> 26237                          Raw hides and skins, leather, furskins and articles thereof, saddlery and harness, travel goods, handbags and similar containers, articles of animal gut (other than silk-worm gut) #> 26238                                            Wood and articles of wood, wood charcoal, cork and articles of cork, manufacturers of straw, of esparto or of other plaiting materials, basketwork and wickerwork #> 26239                                                             Pulp of wood or of other fibrous cellulosic material, recovered (waste and scrap) paper or paperboard, paper and paperboard and articles thereof #> 26240                                                                                                                                                                                 Textile and textile articles #> 26241 Footwear, headgear, umbrellas, sun umbrellas, walking-sticks, seat-sticks, whips, riding-crops and parts thereof, prepared feathers and articles made therewith, artificial flowers, articles of human hair. #> 26242                                                                                              Articles of stone, plaster, cement, asbestos, mica, or similar materials, ceramic products, glass and glassware #> 26243                                              Natural or cultured pearls, precious or semi-precious stones, precious metals, metal clad with precious metal, and articles thereof, imitation jewellery, coins #> 26244                                                                                                                                                                       Base metals and articles of base metal #> 26245  Machinery and mechanical appliances, electrical equipment, parts thereof, sound recorders and reproducers, television image and souch recorders and reproducers, and parts and accessories of such articles #> 26246                                                                                                                                               Vehicles, aircraft, vessels and associated transport equipment #> 26247                Optical, photographic, cinematographic, measuring, checking, precision, medical or surgical instruments and apparatus, clocks and watches, musical instruments, parts and accessories thereof #> 26248                                                                                                                                                           Arms and ammunition, parts and accessories thereof #> 26249                                                                                                                                                                          Miscellaneous manufactured articles #> 26250                                                                                                                                                                Works of art, collectors' pieces and antiques #>                                                    hs2_codes       value #> 26230                                          1, 2, 3, 4, 5   4047.6297 #> 26231                         6, 7, 8, 9, 10, 11, 12, 13, 14  44466.0138 #> 26232                                                     15    306.9128 #> 26233                     16, 17, 18, 19, 20, 21, 22, 23, 24  51346.5875 #> 26234                                             25, 26, 27  18430.5662 #> 26235             28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38  70410.8983 #> 26236                                                 39, 40 107293.9331 #> 26237                                             41, 42, 43    367.3535 #> 26238                                             44, 45, 46   1321.2536 #> 26239                                             47, 48, 49  22110.2727 #> 26240 50, 51, 52, 53, 54, 55, 56, 57, 58, 59, 60, 61, 62, 63   9011.9387 #> 26241                                         64, 65, 66, 67    973.3085 #> 26242                                             68, 69, 70   4164.7806 #> 26243                                                     71    175.0221 #> 26244             72, 73, 74, 75, 76, 78, 79, 80, 81, 82, 83  75819.1181 #> 26245                                                 84, 85  85302.7382 #> 26246                                         86, 87, 88, 89 143485.1386 #> 26247                                             90, 91, 92  11087.3447 #> 26248                                                     93    852.2147 #> 26249                                             94, 95, 96   8806.5570 #> 26250                                                     97    149.3303 #>          value_kd     quantity #> 26230   3873.1014 1.352117e+03 #> 26231  42116.8754 5.019097e+04 #> 26232    279.5778 2.736282e+02 #> 26233  49500.2415 2.533764e+04 #> 26234  17881.1629 1.625416e+05 #> 26235  67480.4950 3.381519e+04 #> 26236 102448.6112 8.191542e+04 #> 26237    356.0907 4.876490e+02 #> 26238   1300.7074 1.766760e+03 #> 26239  21560.8662 1.317702e+04 #> 26240   8653.2046 4.482534e+03 #> 26241    958.3432 2.306605e+02 #> 26242   3994.2057 5.822344e+03 #> 26243    172.3183 1.363955e+01 #> 26244  74971.9623 7.522371e+04 #> 26245  82879.6271 2.325024e+04 #> 26246 143010.5935 1.061381e+04 #> 26247  10743.7826 2.134918e+03 #> 26248    823.5848 1.939155e+02 #> 26249   8580.9290 2.617359e+03 #> 26250    146.0542 7.546455e+00"},{"path":"https://sebkrantz.github.io/flownet/reference/consolidate_graph.html","id":null,"dir":"Reference","previous_headings":"","what":"Consolidate Graph — consolidate_graph","title":"Consolidate Graph — consolidate_graph","text":"Consolidate graph removing intermediate nodes (nodes occur exactly twice) optionally dropping loop, duplicate, singleton edges (leading dead ends). simplifies network topology preserving connectivity.","code":""},{"path":"https://sebkrantz.github.io/flownet/reference/consolidate_graph.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Consolidate Graph — consolidate_graph","text":"","code":"consolidate_graph(   graph_df,   directed = FALSE,   drop.edges = c(\"loop\", \"duplicate\", \"single\"),   consolidate = TRUE,   by = NULL,   keep.nodes = NULL,   ...,   recursive = \"full\",   verbose = TRUE )"},{"path":"https://sebkrantz.github.io/flownet/reference/consolidate_graph.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Consolidate Graph — consolidate_graph","text":"graph_df data frame representing graph columns: (node IDs), optionally columns preserve. coordinate columns (FX, FY, TX, TY) present, preserved updated based consolidated node coordinates. directed Logical (default: FALSE). Whether graph directed. drop.edges Character vector (default: c(\"loop\", \"duplicate\", \"single\")). Types edges drop: \"loop\" removes self-loops (edges == ), \"duplicate\" removes duplicate edges (-pair), \"single\" removes edges leading singleton nodes (nodes occur ). Set NULL keep edges. consolidate Logical (default: TRUE). TRUE, consolidates graph removing intermediate nodes (nodes occur exactly twice) merging connecting edges. FALSE, drops edges specified drop.edges. Link characteristics preserve/consolidate across, passed one-sided formula character vector column names. Typically includes attributes like mode, type, capacity ensure edges characteristics consolidated. keep.nodes Numeric vector (optional). Node IDs preserve consolidation, even occur exactly twice. Also used preserve nodes dropping singleton edges. ... Arguments passed collap() aggregation across consolidated edges. defaults FUN = fmean numeric columns catFUN = fmode categorical columns. Select columns using cols use argument custom = list(fmean = cols1, fsum = cols2, fmode = cols3) map different columns specific aggregation functions. highly recommended weight aggregation (using w = ~ weight_col) length/cost edges. recursive One \"none\"/FALSE, \"partial\" (recurse dropping single edges consolidation aggregate ), \"full\"/TRUE (recursively consolidates aggregates graph consolidation possible). ensures long chains intermediate nodes fully consolidated single call. verbose Logical (default: TRUE). Whether print messages dropped edges consolidation progress.","code":""},{"path":"https://sebkrantz.github.io/flownet/reference/consolidate_graph.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Consolidate Graph — consolidate_graph","text":"data frame representing consolidated graph : edge - Edge identifier (added first column) columns graph_df (aggregated consolidation occurred),       excluding , , optionally FX, FY, TX, TY       (re-added present original) , - Node IDs (updated consolidation) Coordinate columns (FX, FY, TX, TY) present original Attribute \"keep.edges\" - Indices original edges kept Attribute \"gid\" - Edge group IDs mapping consolidated edges original edges","code":""},{"path":"https://sebkrantz.github.io/flownet/reference/consolidate_graph.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Consolidate Graph — consolidate_graph","text":"function simplifies graph : Dropping edges: Optionally removes self-loops, duplicate edges, edges     leading singleton nodes (nodes appear graph) Consolidating nodes: Removes intermediate nodes (nodes occur exactly twice)     merging two edges connected single longer edge Aggregating attributes: edges merged, attributes/columns aggregated     using collap(). default aggregation mean numeric columns mode categorical columns. Recursive consolidation: recursive = TRUE, function continues     consolidating nodes can consolidated, ensuring complete simplification Consolidation useful simplifying network topology preserving connectivity. example, node B connects ->B B->C, removed replaced ->C. recursive = TRUE, long chains (->B->C->D) fully consolidated ->D single call. undirected graphs, algorithm also handles cases node appears twice either origin destination (circular cases). coordinate columns (FX, FY, TX, TY) present input, preserved updated based consolidated node coordinates original graph.","code":""},{"path":[]},{"path":"https://sebkrantz.github.io/flownet/reference/consolidate_graph.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Consolidate Graph — consolidate_graph","text":"","code":"library(flownet) library(sf)  # Convert segments to undirected graph graph <- africa_segments |>   linestrings_from_graph() |>   linestrings_to_graph() |>   create_undirected_graph(FUN = \"fsum\")  # Get nodes to preserve (city/port locations) nodes <- nodes_from_graph(graph, sf = TRUE) nearest_nodes <- nodes$node[st_nearest_feature(africa_cities_ports, nodes)]  # Consolidate graph, preserving city nodes graph_cons <- consolidate_graph(graph, keep = nearest_nodes, w = ~ passes) #> Consolidating undirected graph graph with 11385 edges using full recursion #> Initial node degrees: #>    1    2    3    4    5    6    7    8    9   10  #>  125 5293 3240  395  102   31    4    2    1    1  #>  #> Dropped 44 loop edges #> Dropped 11 edges leading to singleton nodes #> Oriented 3431 undirected intermediate edges #> Consolidated 5079 intermediate nodes #> Oriented 10 undirected intermediate edges #> Consolidated 10 intermediate nodes #> Aggregated 11330 edges down to 6597 edges #> Oriented 361 undirected intermediate edges #> Consolidated 375 intermediate nodes #> Oriented 8 undirected intermediate edges #> Consolidated 8 intermediate nodes #> Aggregated 6597 edges down to 6264 edges #> Oriented 41 undirected intermediate edges #> Consolidated 43 intermediate nodes #> Oriented 1 undirected intermediate edges #> Consolidated 1 intermediate nodes #> Aggregated 6264 edges down to 6224 edges #> Oriented 2 undirected intermediate edges #> Consolidated 3 intermediate nodes #> Aggregated 6224 edges down to 6221 edges #> No nodes to consolidate, returning graph #>  #> Consolidated undirected graph graph from 11385 edges to 6221 edges (54.6%) #> Final node degrees: #>    1    2    3    4    5    6    7    8  #>  114  236 3246  392   84   18    2    1   # Consolidated graph has fewer edges c(original = nrow(graph), consolidated = nrow(graph_cons)) #>     original consolidated  #>        11385         6221"},{"path":"https://sebkrantz.github.io/flownet/reference/create_undirected_graph.html","id":null,"dir":"Reference","previous_headings":"","what":"Create Undirected Graph — create_undirected_graph","title":"Create Undirected Graph — create_undirected_graph","text":"Convert directed graph undirected graph normalizing edges aggregating duplicate connections.","code":""},{"path":"https://sebkrantz.github.io/flownet/reference/create_undirected_graph.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Create Undirected Graph — create_undirected_graph","text":"","code":"create_undirected_graph(graph_df, by = NULL, ...)"},{"path":"https://sebkrantz.github.io/flownet/reference/create_undirected_graph.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Create Undirected Graph — create_undirected_graph","text":"graph_df data frame representing directed graph including columns: , , (optionally) edge, FX, FY, TX, TY. Link characteristics preserve/aggregate across, passed one-sided formula character vector column names. Typically includes attributes like mode, type, capacity ensure edges characteristics aggregated. ... Arguments passed collap() aggregation across duplicated (diretional) edges. defaults FUN = fmean numeric columns catFUN = fmode categorical columns. Select columns using cols use argument custom = list(fmean = cols1, fsum = cols2, fmode = cols3) map different columns specific aggregation functions. can weight aggregation (using w = ~ weight_col).","code":""},{"path":"https://sebkrantz.github.io/flownet/reference/create_undirected_graph.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Create Undirected Graph — create_undirected_graph","text":"data frame representing undirected graph : edge - Edge identifier (first value duplicates) - Starting node ID (normalized < ) - Ending node ID (normalized > ) FX - Starting node X-coordinate (first value duplicates) FY - Starting node Y-coordinate (first value duplicates) TX - Ending node X-coordinate (first value duplicates) TY - Ending node Y-coordinate (first value duplicates) Aggregated columns","code":""},{"path":"https://sebkrantz.github.io/flownet/reference/create_undirected_graph.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Create Undirected Graph — create_undirected_graph","text":"function converts directed graph undirected graph : Normalizing edge directions < edges Collapsing duplicate edges (nodes) spatial/identifier columns (edge, FX, FY, TX, TY),     taking first value duplicates aggregation columns, collap() applied.","code":""},{"path":"https://sebkrantz.github.io/flownet/reference/create_undirected_graph.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Create Undirected Graph — create_undirected_graph","text":"","code":"library(flownet)  # Convert segments to graph and make undirected graph <- africa_segments |>   linestrings_from_graph() |>   linestrings_to_graph() graph_undir <- create_undirected_graph(graph, FUN = \"fsum\")  # Fewer edges after removing directional duplicates c(directed = nrow(graph), undirected = nrow(graph_undir)) #>   directed undirected  #>      14358      11385"},{"path":"https://sebkrantz.github.io/flownet/reference/distances_from_graph.html","id":null,"dir":"Reference","previous_headings":"","what":"Compute Distance Matrix from Graph — distances_from_graph","title":"Compute Distance Matrix from Graph — distances_from_graph","text":"Compute distance matrix node pairs graph using cppRouting.","code":""},{"path":"https://sebkrantz.github.io/flownet/reference/distances_from_graph.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Compute Distance Matrix from Graph — distances_from_graph","text":"","code":"distances_from_graph(graph_df, directed = FALSE, cost.column = \"cost\", ...)"},{"path":"https://sebkrantz.github.io/flownet/reference/distances_from_graph.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Compute Distance Matrix from Graph — distances_from_graph","text":"graph_df data frame representing graph columns: , , cost. directed Logical (default: FALSE). TRUE, treats graph directed; FALSE, treats undirected. cost.column Character string (optional). Name cost column graph_df. Alternatively, numeric vector edge costs length equal nrow(graph_df). ... Additional arguments passed distances(), v () compute paths specific nodes.","code":""},{"path":"https://sebkrantz.github.io/flownet/reference/distances_from_graph.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Compute Distance Matrix from Graph — distances_from_graph","text":"matrix distances node pairs, rows columns   correspond node IDs. matrix contains shortest path distances   (based cost column) pairs nodes.","code":""},{"path":"https://sebkrantz.github.io/flownet/reference/distances_from_graph.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Compute Distance Matrix from Graph — distances_from_graph","text":"function: Converts graph data frame cppRouting graph object Contracts graph efficient distance computation Computes distance matrix node pairs using specified algorithm","code":""},{"path":"https://sebkrantz.github.io/flownet/reference/distances_from_graph.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Compute Distance Matrix from Graph — distances_from_graph","text":"","code":"library(flownet)  # Create a simple graph graph <- data.frame(   from = c(1, 2, 2, 3),   to = c(2, 3, 4, 4),   cost = c(1, 2, 3, 1) )  # Compute distance matrix dmat <- distances_from_graph(graph, cost.column = \"cost\") dmat #>   1 2 3 4 #> 1 0 1 3 4 #> 2 1 0 2 3 #> 3 3 2 0 1 #> 4 4 3 1 0"},{"path":"https://sebkrantz.github.io/flownet/reference/flownet-package.html","id":null,"dir":"Reference","previous_headings":"","what":"Efficient Transport Modeling — flownet-package","title":"Efficient Transport Modeling — flownet-package","text":"flownet provides efficient tools transportation modeling R, supporting network processing, route enumeration, traffic assignment tasks. implements path-sized logit (PSL) model traffic assignment provides powerful utilities network processing/preparation. Network Processing linestrings_to_graph() — Convert LINESTRING geometries graphcreate_undirected_graph() — Convert directed graph undirectedconsolidate_graph() — Consolidate graph removing intermediate nodessimplify_network() — Simplify network graph Traffic Assignment run_assignment() — Run traffic assignment using path-sized logit model Graph Utilities normalize_graph() — Normalize node IDs consecutive integersnodes_from_graph() — Extract unique nodes graphlinestrings_from_graph() — Convert graph LINESTRING geometriesdistances_from_graph() — Compute distance matrix graph OD Matrix Utilities melt_od_matrix() — Convert origin-destination matrix long format Data africa_trade — Average BACI HS96 2012-22 trade flows section 47 continental African countriesafrica_cities_ports — 453 largest (port-)cities continental Africa within 70km radius - Krantz (2024), doi:10.1596/1813-9450-10893 africa_network — African continental road network + extensions optimally connect 453 cities - Krantz (2024), doi:10.1596/1813-9450-10893 africa_segments — Primary segments derived OpenStreetMap routes 453 cities - Krantz (2024), doi:10.1596/1813-9450-10893 Replication materials: https://github.com/SebKrantz/OptimalAfricanRoads","code":""},{"path":"https://sebkrantz.github.io/flownet/reference/flownet-package.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Efficient Transport Modeling — flownet-package","text":"package uses efficient C implementations critical path operations leverages: collapse - Fast data transformations geodist - Fast geodesic distance computations igraph - Graph operations shortest path algorithms leaderCluster - Fast spatial clustering network simplification","code":""},{"path":"https://sebkrantz.github.io/flownet/reference/flownet-package.html","id":"author","dir":"Reference","previous_headings":"","what":"Author","title":"Efficient Transport Modeling — flownet-package","text":"Sebastian Krantz sebastian.krantz@graduateinstitute.ch Kamol Roy kamol.roy08@gmail.com","code":""},{"path":"https://sebkrantz.github.io/flownet/reference/linestrings_from_graph.html","id":null,"dir":"Reference","previous_headings":"","what":"Convert Graph to Linestrings — linestrings_from_graph","title":"Convert Graph to Linestrings — linestrings_from_graph","text":"Convert graph data frame node coordinates sf object LINESTRING geometries.","code":""},{"path":"https://sebkrantz.github.io/flownet/reference/linestrings_from_graph.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Convert Graph to Linestrings — linestrings_from_graph","text":"","code":"linestrings_from_graph(graph_df, crs = 4326)"},{"path":"https://sebkrantz.github.io/flownet/reference/linestrings_from_graph.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Convert Graph to Linestrings — linestrings_from_graph","text":"graph_df data frame representing graph columns: FX, FY, TX, TY (starting ending node coordinates), optionally columns preserve. crs Numeric character (default: 4326). Coordinate reference system assign output sf object.","code":""},{"path":"https://sebkrantz.github.io/flownet/reference/linestrings_from_graph.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Convert Graph to Linestrings — linestrings_from_graph","text":"sf data frame LINESTRING geometry, containing columns   graph_df except FX, FY, TX, TY. row   represents edge LINESTRING connecting -node (FX, FY)   -node (TX, TY).","code":""},{"path":"https://sebkrantz.github.io/flownet/reference/linestrings_from_graph.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Convert Graph to Linestrings — linestrings_from_graph","text":"function inverse operation linestrings_to_graph. : Creates LINESTRING geometries node coordinates (FX, FY, TX, TY) Removes coordinate columns output Preserves columns input graph data frame Returns sf object suitable spatial operations visualization","code":""},{"path":[]},{"path":"https://sebkrantz.github.io/flownet/reference/linestrings_from_graph.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Convert Graph to Linestrings — linestrings_from_graph","text":"","code":"library(flownet) library(sf)  # Convert segments data frame to sf LINESTRING object segments_sf <- linestrings_from_graph(africa_segments) class(segments_sf) #> [1] \"sf\"         \"data.frame\" head(segments_sf) #> Simple feature collection with 6 features and 3 fields #> Geometry type: LINESTRING #> Dimension:     XY #> Bounding box:  xmin: -17.44759 ymin: 14.40844 xmax: -16.63849 ymax: 21.28569 #> Geodetic CRS:  WGS 84 #>   passes  gravity gravity_rd                       geometry #> 1     59 93.20669  67.218731 LINESTRING (-17.44759 14.69... #> 2      6 59.98582  45.491608 LINESTRING (-17.44759 14.69... #> 3     48 61.68941  42.121072 LINESTRING (-17.04861 14.70... #> 4     11 31.51728  25.097660 LINESTRING (-17.04861 14.70... #> 5     63  4.09779   2.981159 LINESTRING (-17.03345 20.93... #> 6     10 20.13822  14.737626 LINESTRING (-16.96602 14.72...  if (FALSE) { # \\dontrun{ # Plot segments colored by route importance plot(segments_sf[\"passes\"]) } # }"},{"path":"https://sebkrantz.github.io/flownet/reference/linestrings_to_graph.html","id":null,"dir":"Reference","previous_headings":"","what":"Convert Linestring to Graph — linestrings_to_graph","title":"Convert Linestring to Graph — linestrings_to_graph","text":"Convert Linestring Graph","code":""},{"path":"https://sebkrantz.github.io/flownet/reference/linestrings_to_graph.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Convert Linestring to Graph — linestrings_to_graph","text":"","code":"linestrings_to_graph(   lines,   digits = 6,   keep.cols = is.atomic,   compute.length = TRUE )"},{"path":"https://sebkrantz.github.io/flownet/reference/linestrings_to_graph.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Convert Linestring to Graph — linestrings_to_graph","text":"lines sf data frame LINESTRING geometries. digits Numeric rounding applied coordinates (ensure matching points across different linestrings impaired numeric precision issues). Set NA/Inf/FALSE disable. keep.cols Character vector column names keep input data frame. compute.length Applies st_length() saves additional column named \".length\".","code":""},{"path":"https://sebkrantz.github.io/flownet/reference/linestrings_to_graph.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Convert Linestring to Graph — linestrings_to_graph","text":"data.frame representing graph columns: edge - Edge identifier - Starting node ID FX - Starting node X-coordinate (longitude) FY - Starting node Y-coordinate (latitude) - Ending node ID TX - Ending node X-coordinate (longitude) TY - Ending node Y-coordinate (latitude)","code":""},{"path":[]},{"path":"https://sebkrantz.github.io/flownet/reference/linestrings_to_graph.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Convert Linestring to Graph — linestrings_to_graph","text":"","code":"library(flownet) library(sf)  # Load existing network edges (exclude proposed new links) africa_net <- africa_network[!africa_network$add, ]  # Convert network LINESTRING geometries to graph graph <- linestrings_to_graph(africa_net) head(graph) #>   edge from        FX       FY to        TX       TY      .length from to #> 1    1    1 -17.44671 14.69281  2 -17.04453 14.70297 64809.24 [m]    1  2 #> 2    2    2 -17.04453 14.70297  3 -16.63849 15.11222 72572.59 [m]    2  3 #> 3    3    2 -17.04453 14.70297  4 -16.46332 14.75651 74979.30 [m]    2  4 #> 4    4    2 -17.04453 14.70297  5 -16.42054 14.34236 95828.61 [m]    2  5 #> 5    5    3 -16.63849 15.11222  4 -16.46332 14.75651 46890.83 [m]    3  4 #> 6    6    3 -16.63849 15.11222 10 -16.24391 15.63569 71956.96 [m]    3 10 #>   from_ctry to_ctry        FX       FY        TX       TY sp_distance distance #> 1       SEN     SEN -17.44671 14.69281 -17.04453 14.70297    43272.22  65988.0 #> 2       SEN     SEN -17.04453 14.70297 -16.63849 15.11222    63043.01  87290.5 #> 3       SEN     SEN -17.04453 14.70297 -16.46332 14.75651    62786.56  89469.5 #> 4       SEN     SEN -17.04453 14.70297 -16.42054 14.34236    78226.09  99998.0 #> 5       SEN     SEN -16.63849 15.11222 -16.46332 14.75651    43802.37  61111.5 #> 6       SEN     SEN -16.63849 15.11222 -16.24391 15.63569    71956.96  73391.0 #>   duration speed_kmh   passes     gravity  gravity_rd border_dist total_dist #> 1    46.15  85.79155 104.3333 215.3302926 157.5228265           0    65988.0 #> 2    72.25  72.49038  10.0000  20.1382178  14.7376257           0    87290.5 #> 3    61.10  87.85876   1.5000  11.6420372  10.5577017           0    89469.5 #> 4    72.90  82.30288  55.0000 122.2011739  88.0080152           0    99998.0 #> 5    72.90  50.29753   1.0000   0.5259515   0.3953356           0    61111.5 #> 6    61.20  71.95196  31.0000  23.0342955  16.8520354           0    73391.0 #>   border_time total_time duration_100kmh total_time_100kmh      rugg  pop_wpop #> 1           0      46.15         39.5928           39.5928 25203.645 670689.38 #> 2           0      72.25         52.3743           52.3743 23656.895 191412.11 #> 3           0      61.10         53.6817           53.6817 25761.240 177027.86 #> 4           0      72.90         59.9988           59.9988 24773.338 137874.58 #> 5           0      72.90         36.6669           36.6669 11331.973  65316.04 #> 6           0      61.20         44.0346           44.0346  1745.889 102835.91 #>   pop_wpop_km2  cost_km             upgrade_cat ug_cost_km   add #> 1    2262.9802 699437.0 Asphalt Mix Resurfacing   165533.4 FALSE #> 2     450.2150 605210.4             Mixed Works   325804.9 FALSE #> 3     415.0577 607229.6 Asphalt Mix Resurfacing   143711.0 FALSE #> 4     262.0664 581289.6 Asphalt Mix Resurfacing   137571.9 FALSE #> 5     216.0512 520634.9                 Upgrade   440804.2 FALSE #> 6     212.9464 415457.6             Mixed Works   223654.7 FALSE  # Graph contains edge, from/to nodes, and coordinates names(graph) #>  [1] \"edge\"              \"from\"              \"FX\"                #>  [4] \"FY\"                \"to\"                \"TX\"                #>  [7] \"TY\"                \".length\"           \"from\"              #> [10] \"to\"                \"from_ctry\"         \"to_ctry\"           #> [13] \"FX\"                \"FY\"                \"TX\"                #> [16] \"TY\"                \"sp_distance\"       \"distance\"          #> [19] \"duration\"          \"speed_kmh\"         \"passes\"            #> [22] \"gravity\"           \"gravity_rd\"        \"border_dist\"       #> [25] \"total_dist\"        \"border_time\"       \"total_time\"        #> [28] \"duration_100kmh\"   \"total_time_100kmh\" \"rugg\"              #> [31] \"pop_wpop\"          \"pop_wpop_km2\"      \"cost_km\"           #> [34] \"upgrade_cat\"       \"ug_cost_km\"        \"add\""},{"path":"https://sebkrantz.github.io/flownet/reference/melt_od_matrix.html","id":null,"dir":"Reference","previous_headings":"","what":"Melt Origin-Destination Matrix to Long Format — melt_od_matrix","title":"Melt Origin-Destination Matrix to Long Format — melt_od_matrix","text":"Convert origin-destination (OD) matrix long-format data frame   columns , , flow.","code":""},{"path":"https://sebkrantz.github.io/flownet/reference/melt_od_matrix.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Melt Origin-Destination Matrix to Long Format — melt_od_matrix","text":"","code":"melt_od_matrix(od_matrix, nodes = NULL, sort = TRUE)"},{"path":"https://sebkrantz.github.io/flownet/reference/melt_od_matrix.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Melt Origin-Destination Matrix to Long Format — melt_od_matrix","text":"od_matrix numeric matrix origin-destination flows. Rows represent origins, columns represent destinations. matrix square (number rows columns). nodes (Optional) Numeric integer vector node IDs graph matching rows columns matrix. provided, must length equal nrow(od_matrix) ncol(od_matrix). nodes provided, IDs used directly, ignoring row column names. particularly useful mapping zone-based OD matrices graph node IDs (e.g., using st_nearest_feature find nearest graph nodes). omitted, row column names (present) used node IDs, coerced integer possible. names available coerced integer, sequential integers used. sort Sort long OD-matrix ascending order columns. can computational benefits, e.g., multithreading method = \"AoN\".","code":""},{"path":"https://sebkrantz.github.io/flownet/reference/melt_od_matrix.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Melt Origin-Destination Matrix to Long Format — melt_od_matrix","text":"data frame columns: - Origin node ID (integer) - Destination node ID (integer) flow - Flow value (numeric) rows finite, positive flow values included.","code":""},{"path":"https://sebkrantz.github.io/flownet/reference/melt_od_matrix.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Melt Origin-Destination Matrix to Long Format — melt_od_matrix","text":"function converts square OD matrix long format, required run_assignment(). behavior depends whether nodes provided: nodes provided: nodes vector used directly node IDs origins destinations Row column names ignored (must match present) recommended approach working zone-based OD matrices need     mapped graph nodes, ensures node IDs match graph nodes omitted: Row column names extracted matrix (available) Names coerced integer possible; coercion fails names missing,     sequential integers used approach works well matrix row/column names already correspond graph node IDs cases, function: Creates long-format data frame origin-destination pairs Filters non-finite zero flow values function useful converting OD matrices long format required run_assignment().","code":""},{"path":[]},{"path":"https://sebkrantz.github.io/flownet/reference/melt_od_matrix.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Melt Origin-Destination Matrix to Long Format — melt_od_matrix","text":"","code":"library(flownet) library(sf)  # Load existing network and convert to graph africa_net <- africa_network[!africa_network$add, ] graph <- linestrings_to_graph(africa_net) nodes <- nodes_from_graph(graph, sf = TRUE)  # Map cities/ports to nearest network nodes nearest_nodes <- nodes$node[st_nearest_feature(africa_cities_ports, nodes)]  # Example 1: Simple gravity-based OD matrix od_mat <- outer(africa_cities_ports$population, africa_cities_ports$population) / 1e12 dimnames(od_mat) <- list(nearest_nodes, nearest_nodes) od_long <- melt_od_matrix(od_mat) head(od_long) #>   from to       flow #> 1    1  1 10.3925963 #> 2    1  6  0.3804031 #> 3    1  8  4.6445025 #> 4    1 11  3.1488124 #> 5    1 13  0.6058467 #> 6    1 15  0.4982475  # Example 2: Using nodes argument (when matrix has zone IDs, not node IDs) # Here zones are 1:n_cities, nodes argument maps them to graph nodes dimnames(od_mat) <- NULL od_long2 <- melt_od_matrix(od_mat, nodes = nearest_nodes) head(od_long2) #>   from to       flow #> 1    1  1 10.3925963 #> 2    1  6  0.3804031 #> 3    1  8  4.6445025 #> 4    1 11  3.1488124 #> 5    1 13  0.6058467 #> 6    1 15  0.4982475"},{"path":"https://sebkrantz.github.io/flownet/reference/nodes_from_graph.html","id":null,"dir":"Reference","previous_headings":"","what":"Extract Nodes from Graph — nodes_from_graph","title":"Extract Nodes from Graph — nodes_from_graph","text":"Extract unique nodes coordinates graph data frame.","code":""},{"path":"https://sebkrantz.github.io/flownet/reference/nodes_from_graph.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Extract Nodes from Graph — nodes_from_graph","text":"","code":"nodes_from_graph(graph_df, sf = FALSE, crs = 4326)"},{"path":"https://sebkrantz.github.io/flownet/reference/nodes_from_graph.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Extract Nodes from Graph — nodes_from_graph","text":"graph_df data frame representing graph columns: , , FX, FY, TX, TY. sf Logical. TRUE, returns result sf POINT object. Default: FALSE. crs Coordinate reference system sf output; default 4326.","code":""},{"path":"https://sebkrantz.github.io/flownet/reference/nodes_from_graph.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Extract Nodes from Graph — nodes_from_graph","text":"data frame (sf object sf = TRUE) unique nodes coordinates: node - Node ID X - Node X-coordinate (typically longitude) Y - Node Y-coordinate (typically latitude) Result sorted node ID.","code":""},{"path":"https://sebkrantz.github.io/flownet/reference/nodes_from_graph.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Extract Nodes from Graph — nodes_from_graph","text":"function extracts unique nodes columns graph, along corresponding coordinates. Duplicate nodes removed, keeping unique node IDs coordinates.","code":""},{"path":"https://sebkrantz.github.io/flownet/reference/nodes_from_graph.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Extract Nodes from Graph — nodes_from_graph","text":"","code":"library(flownet) library(sf)  # Load existing network edges and convert to graph africa_net <- africa_network[!africa_network$add, ] graph <- linestrings_to_graph(africa_net)  # Extract nodes from graph nodes <- nodes_from_graph(graph) head(nodes) #>   node         X        Y #> 1    1 -17.44671 14.69281 #> 2    2 -17.04453 14.70297 #> 3    3 -16.63849 15.11222 #> 4    4 -16.46332 14.75651 #> 5    5 -16.42054 14.34236 #> 6    6 -17.03333 20.93330  # Get nodes as sf POINT object for spatial operations nodes_sf <- nodes_from_graph(graph, sf = TRUE) class(nodes_sf) #> [1] \"sf\"         \"data.frame\"  # Find nearest network nodes to cities/ports nearest_nodes <- nodes_sf$node[st_nearest_feature(africa_cities_ports, nodes_sf)] head(nearest_nodes) #> [1]  903  275  609  553  880 1372"},{"path":"https://sebkrantz.github.io/flownet/reference/normalize_graph.html","id":null,"dir":"Reference","previous_headings":"","what":"Normalize Graph Node IDs — normalize_graph","title":"Normalize Graph Node IDs — normalize_graph","text":"Normalize node IDs graph consecutive integers starting 1.   useful ensuring compatibility graph algorithms require sequential node IDs.","code":""},{"path":"https://sebkrantz.github.io/flownet/reference/normalize_graph.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Normalize Graph Node IDs — normalize_graph","text":"","code":"normalize_graph(graph_df)"},{"path":"https://sebkrantz.github.io/flownet/reference/normalize_graph.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Normalize Graph Node IDs — normalize_graph","text":"graph_df data frame representing graph columns: (node IDs).","code":""},{"path":"https://sebkrantz.github.io/flownet/reference/normalize_graph.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Normalize Graph Node IDs — normalize_graph","text":"data frame structure graph_df,   columns remapped consecutive integer IDs starting 1.   columns preserved unchanged.","code":""},{"path":"https://sebkrantz.github.io/flownet/reference/normalize_graph.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Normalize Graph Node IDs — normalize_graph","text":"function: Extracts unique node IDs columns Sorts ascending order Remaps original node IDs sequential integers (1, 2, 3, ...) Updates columns normalized IDs Normalization useful : Node IDs non-consecutive (e.g., 1, 5, 10, 20) Node IDs non-numeric contain gaps Graph algorithms require sequential integer node IDs starting 1 Note: function normalizes node IDs; modify graph structure attributes. mapping preserves relative ordering nodes.","code":""},{"path":[]},{"path":"https://sebkrantz.github.io/flownet/reference/normalize_graph.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Normalize Graph Node IDs — normalize_graph","text":"","code":"library(flownet)  # Create graph with non-consecutive node IDs graph <- data.frame(   from = c(10, 20, 20),   to = c(20, 30, 40),   cost = c(1, 2, 3) )  # Normalize to consecutive integers (1, 2, 3, 4) graph_norm <- normalize_graph(graph) graph_norm #>   from to cost #> 1    1  2    1 #> 2    2  3    2 #> 3    2  4    3"},{"path":"https://sebkrantz.github.io/flownet/reference/run_assignment.html","id":null,"dir":"Reference","previous_headings":"","what":"Run Traffic Assignment — run_assignment","title":"Run Traffic Assignment — run_assignment","text":"Assign traffic flows network edges using either Path-Sized Logit (PSL)   --Nothing (AoN) assignment methods.","code":""},{"path":"https://sebkrantz.github.io/flownet/reference/run_assignment.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Run Traffic Assignment — run_assignment","text":"","code":"run_assignment(   graph_df,   od_matrix_long,   directed = FALSE,   cost.column = \"cost\",   method = c(\"PSL\", \"AoN\"),   beta = 1,   ...,   detour.max = 1.5,   angle.max = 90,   unique.cost = TRUE,   npaths.max = Inf,   dmat.max.size = 10000^2,   return.extra = NULL,   verbose = TRUE,   nthreads = 1L )  # S3 method for class 'flownet' print(x, ...)"},{"path":"https://sebkrantz.github.io/flownet/reference/run_assignment.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Run Traffic Assignment — run_assignment","text":"graph_df data.frame columns , , optionally cost column. Represents network graph edges nodes. od_matrix_long data.frame columns , , flow. Represents origin-destination matrix long format flow values. directed Logical (default: FALSE). Whether graph directed. cost.column Character string (default: \"cost\") numeric vector. Name cost column graph_df, numeric vector edge costs length equal nrow(graph_df). cost values used compute shortest paths determine route probabilities. method Character string (default: \"PSL\"). Assignment method: \"PSL\": Path-Sized Logit model considering multiple routes overlap correction \"AoN\": --Nothing assignment, assigns flow shortest path (faster route alternatives) beta Numeric (default: 1). Path-sized logit parameter (beta_PSL). used PSL method. ... Additional arguments (currently ignored). detour.max Numeric (default: 1.5). Maximum detour factor alternative routes (applied shortest paths cost). used PSL method. key parameter controlling execution time algorithm: considering routes (higher detour.max) substantially increases computation time. angle.max Numeric (default: 90). Maximum detour angle (degrees, two sided). used PSL method. .e., nodes within angle measured straight line origin destination node considered detours. unique.cost Logical (default: TRUE). Deduplicates paths based total cost prior generating . used PSL method. Since multiple 'intermediate nodes' may path, likely significant number duplicate paths option removes. npaths.max Integer (default: Inf). Maximum number paths compute per OD-pair. used PSL method. number paths exceeds number, random sample taken shortest path. dmat.max.size Integer (default: 1e4^2). Maximum size distance matrices (shortest paths geodesic) precompute. smaller n_nodes^2, full matrix precomputed. Otherwise, computed chunks needed, chunk dmat.max.size elements. used PSL method. return.extra Character vector specifying additional results return. Options include: \"graph\", \"paths\", \"edges\" (PSL ), \"counts\", \"costs\", \"weights\" (PSL ). AoN: \"paths\" returns list shortest paths (one integer vector per OD pair), \"costs\" returns numeric vector shortest path costs, \"counts\" returns global integer vector edge traversal counts. Use \"\" return available extra results selected method. verbose Logical (default: TRUE). Show progress bar intermediate steps completion status? nthreads Integer (default: 1L). Number threads (daemons) use parallel processing mirai. exceed number logical processors. x object class flownet, typically returned run_assignment.","code":""},{"path":"https://sebkrantz.github.io/flownet/reference/run_assignment.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Run Traffic Assignment — run_assignment","text":"list class \"flownet\" containing: call - function call final_flows - Numeric vector assigned flows edge (length nrow(graph_df)) od_pairs_used - Indices OD pairs valid flows Additional elements specified return.extra: graph - igraph graph object paths - PSL: list lists (multiple routes per OD pair); AoN: list integer vectors (one shortest path per OD pair) edges - List edge indices used OD pair (PSL ) edge_counts - PSL: list edge visit counts per OD pair; AoN: integer vector global edge traversal counts path_costs - PSL: list path costs per OD pair; AoN: numeric vector shortest path costs path_weights - List path weights (probabilities) OD pair (PSL )","code":""},{"path":"https://sebkrantz.github.io/flownet/reference/run_assignment.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Run Traffic Assignment — run_assignment","text":"function performs traffic assignment using one two methods: --Nothing (AoN) Method: simple assignment method assigns flow OD pair single shortest path. much faster PSL consider route alternatives overlaps. Parameters detour.max, angle.max, unique.cost, npaths.max, beta, dmat.max.size ignored AoN. Path-Sized Logit (PSL) Method: sophisticated assignment method considers multiple alternative routes: Creates graph graph_df using igraph, normalizing node IDs internally Computes shortest path distance matrix node pairs (chunkwise dmat.max.size < n_nodes^2) origin-destination pair od_matrix_long: Identifies alternative routes (detours) within detour.max shortest path cost. done considering nodes adding shortest paths costs origin node intermediate node (node) intermediate node destination node. angle.max specified, filters detours within specified angle origin destination. means consider intermediate nodes roughly 'direction' destination node, also away terms geodesic distance. also unique.cost = TRUE, duplicate paths removed based total cost. Thus, using shortest-paths-cost matrix matrix geodesic distances nodes (.finite(angle.max)), algorithm pre-selects unique paths plausible terms detour factor (cost) direction actually computing . speeds route enumeration PSL computations considerably. Finds shortest paths origin intermediate nodes intermediate nodes destination Filters paths remove duplicate edges, .e., intermediate node approached departed via edge(s). Computes path-sized logit probabilities accounting route overlap Assigns flows edges based probabilities weighted route overlap Returns results including final flows optionally additional information path-sized logit model accounts route overlap adjusting probabilities based number alternative routes using edge. Flows assigned proportionally computed probabilities. model uses parameter beta control sensitivity route overlap. angle.max specified graph_df contains coordinate columns (FX, FY, TX, TY), function uses geographic distance calculations restrict detours within specified angle, improving computational efficiency route realism.","code":""},{"path":[]},{"path":"https://sebkrantz.github.io/flownet/reference/run_assignment.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Run Traffic Assignment — run_assignment","text":"","code":"library(flownet) library(sf)  # Load existing network edges (exclude proposed new links) africa_net <- africa_network[!africa_network$add, ]  # Convert to graph (use atomic_elem to drop sf geometry, qDF for data.frame) graph <- collapse::atomic_elem(africa_net) |> collapse::qDF() nodes <- nodes_from_graph(graph, sf = TRUE)  # Map cities/ports to nearest network nodes nearest_nodes <- nodes$node[st_nearest_feature(africa_cities_ports, nodes)]  # Simple gravity-based OD matrix od_mat <- outer(africa_cities_ports$population, africa_cities_ports$population) / 1e12 dimnames(od_mat) <- list(nearest_nodes, nearest_nodes) od_matrix_long <- melt_od_matrix(od_mat)  if (FALSE) { # \\dontrun{ # Run Traffic Assignment (All-or-Nothing method) result <- run_assignment(graph, od_matrix_long, cost.column = \"duration\",                          method = \"AoN\", return.extra = \"all\") print(result)  # Visualize Results africa_net$final_flows_log10 <- log10(result$final_flows + 1) plot(africa_net[\"final_flows_log10\"]) } # }"},{"path":"https://sebkrantz.github.io/flownet/reference/simplify_network.html","id":null,"dir":"Reference","previous_headings":"","what":"Simplify Network — simplify_network","title":"Simplify Network — simplify_network","text":"Simplify network graph using shortest paths node clustering methods.","code":""},{"path":"https://sebkrantz.github.io/flownet/reference/simplify_network.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Simplify Network — simplify_network","text":"","code":"simplify_network(   graph_df,   nodes,   method = c(\"shortest-paths\", \"cluster\"),   directed = FALSE,   cost.column = \"cost\",   by = NULL,   radius_km = list(nodes = 7, cluster = 20),   ... )"},{"path":"https://sebkrantz.github.io/flownet/reference/simplify_network.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Simplify Network — simplify_network","text":"graph_df data.frame columns representing graph edges. cluster method, graph must also columns FX, FY, TX, TY representing node coordinates. nodes method = \"shortest-paths\": either atomic vector node IDs, data.frame columns specifying origin-destination pairs. method = \"cluster\": atomic vector node IDs preserve. nodes kept cluster centroids, nearby nodes (within radius_km$nodes) assigned clusters. Remaining nodes clustered using leaderCluster. method Character string (default: \"shortest-paths\"). Method use simplification: \"shortest-paths\" computes shortest paths nodes keeps traversed edges; \"cluster\" clusters nodes using leaderCluster algorithm contracts graph. directed Logical (default: FALSE). Whether graph directed. method = \"shortest-paths\": controls path computation direction. method = \"cluster\": TRUE, ->B B->remain separate edges contraction; FALSE, edges normalized < grouping. cost.column Character string (default: \"cost\"). Name cost column graph_df. Alternatively, numeric vector edge costs length equal nrow(graph_df). method = \"cluster\", numeric vector node weights matching nodes_from_graph(graph_df) can provided. Link characteristics preserve/simplify across, passed one-sided formula character vector column names. Typically includes attributes like mode, type, capacity. method = \"shortest-paths\": paths computed separately group defined , edges current group penalized (cost set 100x max cost) compel mode-specific routes. method = \"cluster\": edges grouped , , columns, preventing consolidation across different modes/types. radius_km Named list elements nodes (default: 7) cluster (default: 20). used method = \"cluster\". nodes: radius kilometers around preserved nodes. Graph nodes within radius assigned nearest preserved node's cluster. cluster: radius kilometers clustering remaining nodes using leaderCluster. ... method = \"cluster\": additional arguments passed collap edge attribute aggregation.","code":""},{"path":"https://sebkrantz.github.io/flownet/reference/simplify_network.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Simplify Network — simplify_network","text":"data.frame containing simplified graph : method = \"shortest-paths\": columns input graph_df (edges kept) Attribute \"edges\": integer vector edge indices original graph Attribute \"edge_counts\": integer vector indicating many times edge traversed method = \"cluster\": edge - New edge identifier , - Cluster centroid node IDs FX, FY, TX, TY - Coordinates cluster centroid nodes Aggregated edge attributes original graph Attribute \"group.id\": mapping original edges simplified edges Attribute \"group.starts\": start indices group Attribute \"group.sizes\": number original edges per simplified edge","code":""},{"path":"https://sebkrantz.github.io/flownet/reference/simplify_network.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Simplify Network — simplify_network","text":"Method: \"shortest-paths\" Validates origin destination nodes exist network Computes shortest paths origin destinations using igraph Marks edges traversed least one shortest path Returns subset edges traversed nodes data frame columns, paths computed     unique origin specified destinations Method: \"cluster\" Requires graph spatial coordinates (FX, FY, TX, TY) nodes provided, nodes preserved cluster centroids Nearby nodes (within radius_km$nodes km) assigned nearest preserved node Remaining nodes clustered using leaderCluster     radius_km$cluster clustering radius cluster, node closest cluster centroid selected representative graph contracted mapping nodes cluster representatives Self-loops (edges endpoints map cluster) dropped undirected graphs (directed = FALSE), edges normalized < ,     merging opposite-direction edges; directed graphs, ->B B->remain separate Edge attributes aggregated using collap (default: mean     numeric, mode categorical); customize via ...","code":""},{"path":"https://sebkrantz.github.io/flownet/reference/simplify_network.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Simplify Network — simplify_network","text":"","code":"library(flownet) library(sf)  # Convert segments to undirected graph graph <- africa_segments |>   linestrings_from_graph() |>   linestrings_to_graph() |>   create_undirected_graph(FUN = \"fsum\")  # Get city/port nodes to preserve nodes_df <- nodes_from_graph(graph, sf = TRUE) nearest_nodes <- nodes_df$node[st_nearest_feature(africa_cities_ports, nodes_df)]  # Initial consolidation graph <- consolidate_graph(graph, keep = nearest_nodes, w = ~ passes) #> Consolidating undirected graph graph with 11385 edges using full recursion #> Initial node degrees: #>    1    2    3    4    5    6    7    8    9   10  #>  125 5293 3240  395  102   31    4    2    1    1  #>  #> Dropped 44 loop edges #> Dropped 11 edges leading to singleton nodes #> Oriented 3431 undirected intermediate edges #> Consolidated 5079 intermediate nodes #> Oriented 10 undirected intermediate edges #> Consolidated 10 intermediate nodes #> Aggregated 11330 edges down to 6597 edges #> Oriented 361 undirected intermediate edges #> Consolidated 375 intermediate nodes #> Oriented 8 undirected intermediate edges #> Consolidated 8 intermediate nodes #> Aggregated 6597 edges down to 6264 edges #> Oriented 41 undirected intermediate edges #> Consolidated 43 intermediate nodes #> Oriented 1 undirected intermediate edges #> Consolidated 1 intermediate nodes #> Aggregated 6264 edges down to 6224 edges #> Oriented 2 undirected intermediate edges #> Consolidated 3 intermediate nodes #> Aggregated 6224 edges down to 6221 edges #> No nodes to consolidate, returning graph #>  #> Consolidated undirected graph graph from 11385 edges to 6221 edges (54.6%) #> Final node degrees: #>    1    2    3    4    5    6    7    8  #>  114  236 3246  392   84   18    2    1   # Method 1: Shortest-paths simplification (keeps only traversed edges) graph_simple <- simplify_network(graph, nearest_nodes,                                  method = \"shortest-paths\",                                  cost.column = \"length\") nrow(graph_simple)  # Reduced number of edges #> [1] 4858  # \\donttest{ # Method 2: Cluster-based simplification (contracts graph spatially) # Compute node weights for clustering node_weights <- collapse::rowbind(   collapse::slt(graph, node = from, gravity_rd),   collapse::slt(graph, to, gravity_rd),   use.names = FALSE) |>   collapse::collap(~ node, collapse::fsum)  graph_cluster <- simplify_network(graph, nearest_nodes,                                   method = \"cluster\",                                   cost.column = node_weights$gravity_rd,                                   radius_km = list(nodes = 30, cluster = 27),                                   w = ~ passes) nrow(graph_cluster) #> [1] 2430 # }"},{"path":[]},{"path":[]},{"path":"https://sebkrantz.github.io/flownet/news/index.html","id":"traffic-assignment-and-route-enumeration-0-1-0","dir":"Changelog","previous_headings":"Major Features","what":"Traffic Assignment and Route Enumeration","title":"flownet 0.1.0 (Initial Release)","text":"Efficient route enumeration algorithm generates sensible alternative routes origin-destination pairs Accounts route overlap using path-sized logit probabilities Supports directed undirected graphs Configurable detour factors angle constraints route selection Optional return detailed path information, edge counts, costs, weights High-performance C implementation critical path operations Multithreading (asynchronous parallelism) using mirai.","code":""},{"path":"https://sebkrantz.github.io/flownet/news/index.html","id":"network-processing-0-1-0","dir":"Changelog","previous_headings":"Major Features","what":"Network Processing","title":"flownet 0.1.0 (Initial Release)","text":"Extracts node coordinates creates edge representations Optional coordinate rounding precision handling Preserves additional columns input data Automatic computation edge lengths Normalizes edge directions aggregates duplicate connections Flexible aggregation using collapse::collap() customizable functions Preserves spatial coordinates line identifiers Removes nodes occur exactly twice, merging connecting edges Optional removal loops, duplicate edges, singleton edges Recursive consolidation complete simplification Weighted aggregation edge attributes Preserves coordinate information present Method “shortest-paths”: Filters network edges used shortest paths specified nodes Method “cluster”: Spatially clusters nodes using leaderCluster algorithm contracts graph","code":""},{"path":"https://sebkrantz.github.io/flownet/news/index.html","id":"graph-utilities-0-1-0","dir":"Changelog","previous_headings":"Major Features","what":"Graph Utilities","title":"flownet 0.1.0 (Initial Release)","text":"Essential graph algorithms requiring sequential node IDs Preserves graph structure remapping identifiers Returns data frame sf POINT object node locations Useful mapping zones network nodes Inverse operation linestrings_to_graph() Preserves graph attributes output sf object Uses igraph efficient shortest path distance computation Supports directed undirected graphs","code":""},{"path":"https://sebkrantz.github.io/flownet/news/index.html","id":"od-matrix-utilities-0-1-0","dir":"Changelog","previous_headings":"Major Features","what":"OD Matrix Utilities","title":"flownet 0.1.0 (Initial Release)","text":"Transforms matrix format edge list suitable traffic assignment Handles missing values zero flows","code":""},{"path":"https://sebkrantz.github.io/flownet/news/index.html","id":"example-data-0-1-0","dir":"Changelog","previous_headings":"Major Features","what":"Example Data","title":"flownet 0.1.0 (Initial Release)","text":"africa_network: road transport network 2,825 LINESTRING features representing existing roads (2,344 edges) proposed new links (481 edges). edge includes attributes distance, travel duration, border crossing costs, terrain ruggedness, road upgrade costs. africa_cities_ports: 453 African cities population > 100,000 international ports. Includes population data, capital status, port cargo outflows. africa_segments: 14,358 raw network segments representing intersected road routes. Useful demonstrating network consolidation simplification functions. africa_trade: Bilateral trade flows 47 African countries aggregated HS section (21 product categories). Values represent annual averages 2012-2022. africa_network, africa_cities_ports, africa_segments datasets Krantz, S. (2024). Optimal Investments Africa’s Road Network. Policy Research Working Paper 10893. World Bank. Replication materials available github.com/SebKrantz/OptimalAfricanRoads.","code":""},{"path":"https://sebkrantz.github.io/flownet/news/index.html","id":"technical-details-0-1-0","dir":"Changelog","previous_headings":"","what":"Technical Details","title":"flownet 0.1.0 (Initial Release)","text":"High-performance C implementations path-sized logit computations Efficient memory management large networks Integration collapse package fast data transformations Uses igraph graph operations shortest path algorithms Leverages geodist fast geodesic distance computations Leverages leaderCluster efficient spatial clustering Comprehensive documentation examples vignettes","code":""},{"path":"https://sebkrantz.github.io/flownet/news/index.html","id":"documentation-0-1-0","dir":"Changelog","previous_headings":"","what":"Documentation","title":"flownet 0.1.0 (Initial Release)","text":"Complete function documentation roxygen2 README quick start guide examples Introduction vignette demonstrating package workflow Package-level documentation ?flownet-package","code":""},{"path":"https://sebkrantz.github.io/flownet/news/index.html","id":"dependencies-0-1-0","dir":"Changelog","previous_headings":"","what":"Dependencies","title":"flownet 0.1.0 (Initial Release)","text":"R (>= 3.5) collapse (>= 2.1.5) - Fast data transformations memory efficient programming kit (>= 0.0.5) - Fast tabulation vectorized switches igraph (>= 2.1.4) - Graph operations shortest path algorithms sf (>= 1.0.0) - Spatial data handling geodist (>= 0.1.1) - Fast geodesic distance computations leaderCluster (>= 0.1.5) - Efficient spatial clustering algorithms mirai (>= 2.5.2) - Asynchronous parallelism R progress (>= 1.2.3) - Progress bars long-running operations","code":""},{"path":"https://sebkrantz.github.io/flownet/news/index.html","id":"suggested-packages-0-1-0","dir":"Changelog","previous_headings":"","what":"Suggested Packages","title":"flownet 0.1.0 (Initial Release)","text":"fastverse (>= 0.3.4) - Efficient data manipulation workflow mapview (>= 2.11.2) - Interactive visualization results tmap (>= 4.0) - Static visualization results","code":""},{"path":"https://sebkrantz.github.io/flownet/news/index.html","id":"license-0-1-0","dir":"Changelog","previous_headings":"","what":"License","title":"flownet 0.1.0 (Initial Release)","text":"GPL-3","code":""}]
